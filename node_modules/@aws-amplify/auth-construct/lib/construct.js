"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.AmplifyAuth = void 0;
const constructs_1 = require("constructs");
const aws_cdk_lib_1 = require("aws-cdk-lib");
const aws_cognito_1 = require("aws-cdk-lib/aws-cognito");
const aws_iam_1 = require("aws-cdk-lib/aws-iam");
const backend_output_schemas_1 = require("@aws-amplify/backend-output-schemas");
const defaults_js_1 = require("./defaults.js");
const backend_output_storage_1 = require("@aws-amplify/backend-output-storage");
const path = __importStar(require("path"));
const aws_kms_1 = require("aws-cdk-lib/aws-kms");
const oauthProviderToProviderDomainMap = {
    facebook: 'graph.facebook.com',
    google: 'accounts.google.com',
    amazon: 'www.amazon.com',
    apple: 'appleid.apple.com',
};
const INVITATION_PLACEHOLDERS = {
    CODE: '{####}',
    USERNAME: '{username}',
};
const VERIFICATION_EMAIL_PLACEHOLDERS = {
    CODE: '{####}',
    LINK: '{##Verify Email##}',
};
const VERIFICATION_SMS_PLACEHOLDERS = {
    CODE: '{####}',
};
const MFA_SMS_PLACEHOLDERS = {
    CODE: '{####}',
};
const DEFAULT_OAUTH_SCOPES = [
    aws_cognito_1.OAuthScope.PHONE,
    aws_cognito_1.OAuthScope.EMAIL,
    aws_cognito_1.OAuthScope.OPENID,
    aws_cognito_1.OAuthScope.PROFILE,
    aws_cognito_1.OAuthScope.COGNITO_ADMIN,
];
// Be very careful editing this value. It is the string that is used to attribute stacks to Amplify Auth in BI metrics
const authStackType = 'auth-Cognito';
/**
 * Amplify Auth CDK Construct
 */
class AmplifyAuth extends constructs_1.Construct {
    /**
     * Create a new Auth construct with AuthProps.
     * If no props are provided, email login and defaults will be used.
     */
    constructor(scope, id, props = defaults_js_1.DEFAULTS.IF_NO_PROPS_PROVIDED) {
        var _a, _b, _c, _d;
        super(scope, id);
        this.groups = {};
        /**
         * Create Auth/UnAuth Roles
         * @returns DefaultRoles
         */
        this.setupAuthAndUnAuthRoles = (identityPoolId) => {
            const result = {
                auth: new aws_iam_1.Role(this, `${this.name}authenticatedUserRole`, {
                    assumedBy: new aws_iam_1.FederatedPrincipal('cognito-identity.amazonaws.com', {
                        StringEquals: {
                            'cognito-identity.amazonaws.com:aud': identityPoolId,
                        },
                        'ForAnyValue:StringLike': {
                            'cognito-identity.amazonaws.com:amr': 'authenticated',
                        },
                    }, 'sts:AssumeRoleWithWebIdentity'),
                }),
                unAuth: new aws_iam_1.Role(this, `${this.name}unauthenticatedUserRole`, {
                    assumedBy: new aws_iam_1.FederatedPrincipal('cognito-identity.amazonaws.com', {
                        StringEquals: {
                            'cognito-identity.amazonaws.com:aud': identityPoolId,
                        },
                        'ForAnyValue:StringLike': {
                            'cognito-identity.amazonaws.com:amr': 'unauthenticated',
                        },
                    }, 'sts:AssumeRoleWithWebIdentity'),
                }),
            };
            return result;
        };
        /**
         * Auto generate the user pool groups and group roles
         */
        this.setupUserPoolGroups = (groups, identityPool) => {
            (groups || []).forEach((groupName, index) => {
                const groupRole = new aws_iam_1.Role(this, `${this.name}${groupName}GroupRole`, {
                    assumedBy: new aws_iam_1.FederatedPrincipal('cognito-identity.amazonaws.com', {
                        StringEquals: {
                            'cognito-identity.amazonaws.com:aud': identityPool.ref,
                        },
                        'ForAnyValue:StringLike': {
                            'cognito-identity.amazonaws.com:amr': 'authenticated',
                        },
                    }, 'sts:AssumeRoleWithWebIdentity'),
                });
                const currentGroup = new aws_cognito_1.CfnUserPoolGroup(this, `${this.name}${groupName}Group`, {
                    userPoolId: this.userPool.userPoolId,
                    groupName: groupName,
                    roleArn: groupRole.roleArn,
                    precedence: index,
                });
                this.groups[groupName] = {
                    cfnUserGroup: currentGroup,
                    role: groupRole,
                };
            });
        };
        /**
         * Setup Identity Pool with default roles/role mappings, and register providers
         */
        this.setupIdentityPool = (userPool, userPoolClient, providerSetupResult) => {
            // setup identity pool
            const region = aws_cdk_lib_1.Stack.of(this).region;
            const identityPool = new aws_cdk_lib_1.aws_cognito.CfnIdentityPool(this, `${this.name}IdentityPool`, {
                allowUnauthenticatedIdentities: defaults_js_1.DEFAULTS.ALLOW_UNAUTHENTICATED_IDENTITIES,
            });
            const roles = this.setupAuthAndUnAuthRoles(identityPool.ref);
            const identityPoolRoleAttachment = new aws_cdk_lib_1.aws_cognito.CfnIdentityPoolRoleAttachment(this, `${this.name}IdentityPoolRoleAttachment`, {
                identityPoolId: identityPool.ref,
                roles: {
                    unauthenticated: roles.unAuth.roleArn,
                    authenticated: roles.auth.roleArn,
                },
                roleMappings: {
                    UserPoolWebClientRoleMapping: {
                        type: 'Token',
                        ambiguousRoleResolution: 'AuthenticatedRole',
                        identityProvider: `cognito-idp.${region}.amazonaws.com/${userPool.userPoolId}:${userPoolClient.userPoolClientId}`,
                    },
                },
            });
            identityPoolRoleAttachment.addDependency(identityPool);
            identityPoolRoleAttachment.node.addDependency(userPoolClient);
            // add cognito provider
            identityPool.cognitoIdentityProviders = [
                {
                    clientId: userPoolClient.userPoolClientId,
                    providerName: `cognito-idp.${region}.amazonaws.com/${userPool.userPoolId}`,
                },
            ];
            // add other providers
            identityPool.supportedLoginProviders = providerSetupResult.oAuthMappings;
            return {
                identityPool,
                identityPoolRoleAttachment,
                roles,
            };
        };
        /**
         * Define bindCustomAttribute to meet requirements of the Cognito API to call the bind method
         */
        this.bindCustomAttribute = (key, attribute) => {
            var _a;
            const baseConfig = {
                dataType: attribute.dataType,
                mutable: (_a = attribute.mutable) !== null && _a !== void 0 ? _a : true,
            };
            let constraints = {};
            // Conditionally add constraint properties based on dataType.
            if (attribute.dataType === 'String') {
                constraints = {
                    stringConstraints: {
                        minLen: attribute.minLen,
                        maxLen: attribute.maxLen,
                    },
                };
            }
            else if (attribute.dataType === 'Number') {
                constraints = {
                    numberConstraints: {
                        min: attribute.min,
                        max: attribute.max,
                    },
                };
            }
            //The final config object includes baseConfig and conditionally added constraint properties.
            const config = {
                ...baseConfig,
                ...constraints,
            };
            return {
                ...config,
                bind: () => config,
            };
        };
        /**
         * Process props into UserPoolProps (set defaults if needed)
         */
        this.getUserPoolProps = (props) => {
            var _a, _b, _c, _d, _e;
            const emailEnabled = props.loginWith.email ? true : false;
            const phoneEnabled = props.loginWith.phone ? true : false;
            const oneOfEmailOrPhone = emailEnabled || phoneEnabled;
            if (!oneOfEmailOrPhone) {
                throw Error('At least one of email or phone must be enabled.');
            }
            let userVerificationSettings = {};
            // extract email settings if settings object is defined
            if (typeof props.loginWith.email === 'object') {
                const emailSettings = props.loginWith.email;
                // verify email body and inject the actual template values which cognito uses
                const emailBody = this.verifyEmailBody(emailSettings);
                userVerificationSettings = {
                    emailBody: emailBody,
                    emailStyle: this.getEmailVerificationStyle(emailSettings.verificationEmailStyle),
                    emailSubject: emailSettings.verificationEmailSubject,
                };
            }
            // extract phone settings if settings object is defined
            if (typeof props.loginWith.phone === 'object') {
                const phoneSettings = props.loginWith.phone;
                let smsMessage;
                if (phoneSettings.verificationMessage &&
                    typeof phoneSettings.verificationMessage === 'function') {
                    // validate sms message structure
                    smsMessage = phoneSettings.verificationMessage(() => VERIFICATION_SMS_PLACEHOLDERS.CODE);
                    if (!smsMessage.includes(VERIFICATION_SMS_PLACEHOLDERS.CODE)) {
                        throw Error("Invalid phone settings. Property 'verificationMessage' must utilize the 'code' parameter at least once as a placeholder for the verification code.");
                    }
                }
                userVerificationSettings = {
                    ...userVerificationSettings,
                    smsMessage: smsMessage,
                };
            }
            const mfaType = this.getMFAType(props.multifactor);
            const mfaMode = this.getMFAMode(props.multifactor);
            // If phone login is enabled along with MFA, cognito requires that mfa SMS type to be enabled.
            if (phoneEnabled && mfaMode && mfaMode !== 'OFF' && !(mfaType === null || mfaType === void 0 ? void 0 : mfaType.sms)) {
                throw Error('Invalid MFA settings. SMS must be enabled in multiFactor if loginWith phone is enabled');
            }
            const { standardAttributes, customAttributes } = Object.entries((_a = props.userAttributes) !== null && _a !== void 0 ? _a : {}).reduce((acc, [key, value]) => {
                if (key.startsWith('custom:')) {
                    const attributeKey = key.replace(/^custom:/i, '');
                    acc.customAttributes[attributeKey] = this.bindCustomAttribute(attributeKey, value);
                }
                else {
                    acc.standardAttributes[key] = value;
                }
                return acc;
            }, { standardAttributes: {}, customAttributes: {} });
            /**
             * Handle KMS key for custom email and sms senders
             * If a custom sender is provided, we either use the provided KMS key ARN
             * or create a new KMS key if one is not provided.
             *
             * If KMS key is provided in both senders, we throw an error
             */
            if (props.senders) {
                const customSmsSender = props.senders.sms && 'handler' in props.senders.sms
                    ? props.senders.sms
                    : undefined;
                const customEmailSender = props.senders.email && 'handler' in props.senders.email
                    ? props.senders.email
                    : undefined;
                // If both custom senders are configured and don't provide same KMS Key, then throw
                if (customSmsSender &&
                    customEmailSender &&
                    customSmsSender.kmsKeyArn &&
                    customEmailSender.kmsKeyArn &&
                    customSmsSender.kmsKeyArn !== customEmailSender.kmsKeyArn) {
                    throw new Error('KMS key ARN must be the same for both email and sms senders');
                }
                else if ((customSmsSender && customSmsSender.kmsKeyArn) ||
                    (customEmailSender && customEmailSender.kmsKeyArn)) {
                    // If at least one custom sender is configured with KMS key, we use it
                    const kmsKeyArn = (_b = customSmsSender === null || customSmsSender === void 0 ? void 0 : customSmsSender.kmsKeyArn) !== null && _b !== void 0 ? _b : customEmailSender === null || customEmailSender === void 0 ? void 0 : customEmailSender.kmsKeyArn;
                    this.customSenderKMSkey = aws_kms_1.Key.fromKeyArn(this, `${this.name}CustomSenderKey`, kmsKeyArn);
                }
                else if (customSmsSender || customEmailSender) {
                    {
                        // If at least one custom sender is configured but no KMS key provided, we create one.
                        this.customSenderKMSkey = new aws_kms_1.Key(customSmsSender
                            ? customSmsSender.handler.stack
                            : customEmailSender.handler.stack, // In if condition we ensure that at lest one of the handler is available
                        `${this.name}CustomSenderKey`, {
                            enableKeyRotation: true,
                        });
                    }
                }
            }
            const smsConfiguration = this.getSmsConfiguration((_c = props.senders) === null || _c === void 0 ? void 0 : _c.sms);
            const userPoolProps = {
                signInCaseSensitive: defaults_js_1.DEFAULTS.SIGN_IN_CASE_SENSITIVE,
                signInAliases: {
                    phone: phoneEnabled,
                    email: emailEnabled,
                },
                keepOriginal: {
                    email: emailEnabled,
                    phone: phoneEnabled,
                },
                autoVerify: {
                    email: emailEnabled,
                    phone: phoneEnabled,
                },
                userVerification: userVerificationSettings,
                passwordPolicy: defaults_js_1.DEFAULTS.PASSWORD_POLICY,
                standardAttributes: {
                    email: defaults_js_1.DEFAULTS.IS_REQUIRED_ATTRIBUTE.email(emailEnabled),
                    phoneNumber: defaults_js_1.DEFAULTS.IS_REQUIRED_ATTRIBUTE.phoneNumber(phoneEnabled),
                    ...standardAttributes,
                },
                customAttributes: {
                    ...customAttributes,
                },
                email: ((_d = props.senders) === null || _d === void 0 ? void 0 : _d.email) && 'fromEmail' in props.senders.email
                    ? aws_cdk_lib_1.aws_cognito.UserPoolEmail.withSES({
                        fromEmail: props.senders.email.fromEmail,
                        fromName: props.senders.email.fromName,
                        replyTo: props.senders.email.replyTo,
                        sesRegion: aws_cdk_lib_1.Stack.of(this).region,
                    })
                    : undefined,
                smsRole: smsConfiguration === null || smsConfiguration === void 0 ? void 0 : smsConfiguration.snsCallerArn,
                smsRoleExternalId: smsConfiguration === null || smsConfiguration === void 0 ? void 0 : smsConfiguration.externalId,
                snsRegion: smsConfiguration === null || smsConfiguration === void 0 ? void 0 : smsConfiguration.snsRegion,
                enableSmsRole: smsConfiguration === null || smsConfiguration === void 0 ? void 0 : smsConfiguration.enableSMSRole,
                selfSignUpEnabled: defaults_js_1.DEFAULTS.ALLOW_SELF_SIGN_UP,
                mfa: mfaMode,
                mfaMessage: this.getMFAMessage(props.multifactor),
                mfaSecondFactor: mfaType,
                accountRecovery: this.getAccountRecoverySetting(emailEnabled, phoneEnabled, props.accountRecovery),
                removalPolicy: aws_cdk_lib_1.RemovalPolicy.DESTROY,
                userInvitation: typeof props.loginWith.email !== 'boolean'
                    ? this.getUserInvitationSettings((_e = props.loginWith.email) === null || _e === void 0 ? void 0 : _e.userInvitation)
                    : undefined,
                customSenderKmsKey: this.customSenderKMSkey,
                userPoolName: props.name || undefined,
            };
            return userPoolProps;
        };
        /**
         * Get email verification style from user props
         * @param verificationEmailStyle - string value
         * @returns verificationEmailStyle - enum value
         */
        this.getEmailVerificationStyle = (verificationEmailStyle) => {
            if (verificationEmailStyle === 'CODE') {
                return aws_cdk_lib_1.aws_cognito.VerificationEmailStyle.CODE;
            }
            else if (verificationEmailStyle === 'LINK') {
                return aws_cdk_lib_1.aws_cognito.VerificationEmailStyle.LINK;
            }
            return undefined;
        };
        /**
         * Determine the account recovery option based on enabled login methods.
         * @param emailEnabled - is email enabled
         * @param phoneEnabled - is phone enabled
         * @param accountRecoveryMethodAsString - the user provided account recovery setting
         * @returns account recovery setting enum value
         */
        this.getAccountRecoverySetting = (emailEnabled, phoneEnabled, accountRecoveryMethodAsString) => {
            const accountRecovery = this.convertAccountRecoveryStringToEnum(accountRecoveryMethodAsString);
            if (accountRecovery !== undefined) {
                return accountRecovery;
            }
            // set default based on enabled login methods
            if (phoneEnabled && emailEnabled) {
                return aws_cdk_lib_1.aws_cognito.AccountRecovery.EMAIL_ONLY;
            }
            if (phoneEnabled) {
                return aws_cdk_lib_1.aws_cognito.AccountRecovery.PHONE_ONLY_WITHOUT_MFA;
            }
            if (emailEnabled) {
                return aws_cdk_lib_1.aws_cognito.AccountRecovery.EMAIL_ONLY;
            }
            return undefined;
        };
        /**
         * Convert user friendly Mfa mode to cognito Mfa Mode.
         * This eliminates the need for users to import cognito.Mfa.
         * @param mfa - MFA settings
         * @returns cognito MFA enforcement mode
         */
        this.getMFAMode = (mfa) => {
            if (mfa) {
                switch (mfa.mode) {
                    case 'OFF':
                        return aws_cognito_1.Mfa.OFF;
                    case 'OPTIONAL':
                        return aws_cognito_1.Mfa.OPTIONAL;
                    case 'REQUIRED':
                        return aws_cognito_1.Mfa.REQUIRED;
                }
            }
            return undefined;
        };
        /**
         * Convert user friendly Mfa type to cognito Mfa type.
         * This eliminates the need for users to import cognito.Mfa.
         * @param mfa - MFA settings
         * @returns cognito MFA type (sms, totp, or email)
         */
        this.getMFAType = (mfa) => {
            return typeof mfa === 'object' && mfa.mode !== 'OFF'
                ? {
                    sms: mfa.sms ? true : false,
                    otp: mfa.totp ? true : false,
                    email: mfa.email ? true : false,
                }
                : undefined;
        };
        /**
         * Convert user friendly account recovery method to cognito AccountRecover enum.
         * This eliminates the need for users to import cognito.AccountRecovery.
         * @param method - account recovery method as a string value
         * @returns cognito.AccountRecovery enum value
         */
        this.convertAccountRecoveryStringToEnum = (method) => {
            if (method !== undefined) {
                return aws_cdk_lib_1.aws_cognito.AccountRecovery[method];
            }
            return undefined;
        };
        /**
         * Extract the MFA message settings and perform validation.
         * @param mfa - MFA settings
         * @returns mfa message
         */
        this.getMFAMessage = (mfa) => {
            if (mfa && mfa.mode !== 'OFF' && typeof mfa.sms === 'object') {
                const message = mfa.sms.smsMessage(() => MFA_SMS_PLACEHOLDERS.CODE);
                if (!message.includes(MFA_SMS_PLACEHOLDERS.CODE)) {
                    throw Error("Invalid MFA settings. Property 'smsMessage' must utilize the 'code' parameter at least once as a placeholder for the verification code.");
                }
                return message;
            }
            return undefined;
        };
        /**
         * Setup External Providers (OAuth/OIDC/SAML) and related settings
         * such as OAuth settings and User Pool Domains
         */
        this.setupExternalProviders = (userPool, loginOptions) => {
            /**
             * If email is enabled, and is the only required attribute, we are able to
             * automatically map the email attribute from external providers, excluding SAML.
             */
            const shouldMapEmailAttributes = loginOptions.email && !loginOptions.phone;
            const result = {
                oAuthMappings: {},
                oAuthSettings: {
                    flows: defaults_js_1.DEFAULTS.OAUTH_FLOWS,
                },
            };
            // external providers
            const external = loginOptions.externalProviders;
            if (!external) {
                return result;
            }
            // make sure logout/callback urls are not empty
            if (external.logoutUrls && external.logoutUrls.length === 0) {
                throw Error('You must define logoutUrls when configuring external login providers.');
            }
            if (external.callbackUrls && external.callbackUrls.length === 0) {
                throw Error('You must define callbackUrls when configuring external login providers.');
            }
            if (external.google) {
                const googleProps = external.google;
                result.google = new aws_cdk_lib_1.aws_cognito.UserPoolIdentityProviderGoogle(this, `${this.name}GoogleIdP`, {
                    userPool,
                    clientId: googleProps.clientId,
                    clientSecretValue: googleProps.clientSecret,
                    attributeMapping: {
                        ...(shouldMapEmailAttributes
                            ? {
                                email: aws_cognito_1.ProviderAttribute.GOOGLE_EMAIL,
                            }
                            : undefined),
                        ...this.convertToCognitoAttributeMapping(googleProps.attributeMapping),
                    },
                    scopes: googleProps.scopes,
                });
                result.oAuthMappings[oauthProviderToProviderDomainMap.google] =
                    external.google.clientId;
            }
            if (external.facebook) {
                result.facebook = new aws_cdk_lib_1.aws_cognito.UserPoolIdentityProviderFacebook(this, `${this.name}FacebookIDP`, {
                    userPool,
                    ...external.facebook,
                    attributeMapping: {
                        ...(shouldMapEmailAttributes
                            ? {
                                email: aws_cognito_1.ProviderAttribute.FACEBOOK_EMAIL,
                            }
                            : undefined),
                        ...this.convertToCognitoAttributeMapping(external.facebook.attributeMapping),
                    },
                });
                result.oAuthMappings[oauthProviderToProviderDomainMap.facebook] =
                    external.facebook.clientId;
            }
            if (external.loginWithAmazon) {
                result.amazon = new aws_cdk_lib_1.aws_cognito.UserPoolIdentityProviderAmazon(this, `${this.name}AmazonIDP`, {
                    userPool,
                    ...external.loginWithAmazon,
                    attributeMapping: {
                        ...(shouldMapEmailAttributes
                            ? {
                                email: aws_cognito_1.ProviderAttribute.AMAZON_EMAIL,
                            }
                            : undefined),
                        ...this.convertToCognitoAttributeMapping(external.loginWithAmazon.attributeMapping),
                    },
                });
                result.oAuthMappings[oauthProviderToProviderDomainMap.amazon] =
                    external.loginWithAmazon.clientId;
            }
            if (external.signInWithApple) {
                result.apple = new aws_cdk_lib_1.aws_cognito.UserPoolIdentityProviderApple(this, `${this.name}AppleIDP`, {
                    userPool,
                    ...external.signInWithApple,
                    attributeMapping: {
                        ...(shouldMapEmailAttributes
                            ? {
                                email: aws_cognito_1.ProviderAttribute.APPLE_EMAIL,
                            }
                            : undefined),
                        ...this.convertToCognitoAttributeMapping(external.signInWithApple.attributeMapping),
                    },
                });
                result.oAuthMappings[oauthProviderToProviderDomainMap.apple] =
                    external.signInWithApple.clientId;
            }
            if (external.oidc && external.oidc.length > 0) {
                result.oidc = [];
                external.oidc.forEach((provider, index) => {
                    var _a, _b;
                    const requestMethod = provider.attributeRequestMethod === undefined
                        ? 'GET' // default if not defined
                        : provider.attributeRequestMethod;
                    const generatedProvider = new aws_cdk_lib_1.aws_cognito.UserPoolIdentityProviderOidc(this, `${this.name}${(_a = provider.name) !== null && _a !== void 0 ? _a : index}OidcIDP`, {
                        userPool,
                        attributeRequestMethod: requestMethod === 'GET'
                            ? aws_cognito_1.OidcAttributeRequestMethod.GET
                            : aws_cognito_1.OidcAttributeRequestMethod.POST,
                        clientId: provider.clientId,
                        clientSecret: provider.clientSecret,
                        endpoints: provider.endpoints,
                        identifiers: provider.identifiers,
                        issuerUrl: provider.issuerUrl,
                        name: provider.name,
                        scopes: provider.scopes,
                        attributeMapping: {
                            ...(shouldMapEmailAttributes
                                ? {
                                    email: {
                                        attributeName: 'email',
                                    },
                                }
                                : undefined),
                            ...this.convertToCognitoAttributeMapping(provider.attributeMapping),
                        },
                    });
                    (_b = result.oidc) === null || _b === void 0 ? void 0 : _b.push(generatedProvider);
                });
            }
            if (external.saml) {
                const saml = external.saml;
                result.saml = new aws_cdk_lib_1.aws_cognito.UserPoolIdentityProviderSaml(this, `${this.name}SamlIDP`, {
                    userPool,
                    attributeMapping: this.convertToCognitoAttributeMapping(saml.attributeMapping),
                    identifiers: saml.identifiers,
                    idpSignout: saml.idpSignout,
                    metadata: {
                        metadataContent: saml.metadata.metadataContent,
                        metadataType: saml.metadata.metadataType === 'FILE'
                            ? aws_cognito_1.UserPoolIdentityProviderSamlMetadataType.FILE
                            : aws_cognito_1.UserPoolIdentityProviderSamlMetadataType.URL,
                    },
                    name: saml.name,
                });
            }
            // Always generate a domain prefix if external provider is configured
            if (this.domainPrefix) {
                this.userPool.addDomain(`${this.name}UserPoolDomain`, {
                    cognitoDomain: { domainPrefix: this.domainPrefix },
                });
            }
            else {
                throw new Error('Cognito Domain Prefix is missing when external providers are configured.');
            }
            // oauth settings for the UserPool client
            result.oAuthSettings = {
                callbackUrls: external.callbackUrls,
                logoutUrls: external.logoutUrls,
                scopes: external.scopes
                    ? this.getOAuthScopes(external.scopes)
                    : DEFAULT_OAUTH_SCOPES,
                flows: defaults_js_1.DEFAULTS.OAUTH_FLOWS,
            };
            return result;
        };
        /**
         * Converts the simplified mapping type to cognito.AttributeMapping.
         * @param mapping the AttributeMapping to convert to a cognito.AttributeMapping
         * @returns cognito.AttributeMapping
         */
        this.convertToCognitoAttributeMapping = (mapping) => {
            if (!mapping) {
                return undefined;
            }
            const result = {};
            for (const [attrName, value] of Object.entries(mapping)) {
                if (typeof value === 'string') {
                    result[attrName] = {
                        attributeName: value,
                    };
                }
                if (typeof value === 'object' && attrName === 'custom') {
                    // dealing with custom attributes
                    const customAttributes = {};
                    for (const [customKey, attrName] of Object.entries(value)) {
                        customAttributes[customKey] = {
                            attributeName: attrName,
                        };
                    }
                    result[attrName] = customAttributes;
                }
            }
            return result;
        };
        /**
         * Convert scopes from string list to OAuthScopes.
         * @param scopes - scope list
         * @returns cognito OAuthScopes
         */
        this.getOAuthScopes = (scopes) => {
            if (scopes === undefined) {
                return [];
            }
            const result = [];
            for (const scope of scopes) {
                result.push(aws_cdk_lib_1.aws_cognito.OAuthScope[scope]);
            }
            return result;
        };
        /**
         * Stores auth output using the provided strategy
         */
        this.storeOutput = (outputStorageStrategy = new backend_output_storage_1.StackMetadataBackendOutputStorageStrategy(aws_cdk_lib_1.Stack.of(this))) => {
            const cfnUserPool = this.resources.cfnResources.cfnUserPool;
            const cfnUserPoolClient = this.resources.cfnResources.cfnUserPoolClient;
            const cfnIdentityPool = this.resources.cfnResources.cfnIdentityPool;
            // these properties cannot be overwritten
            const output = {
                userPoolId: this.resources.userPool.userPoolId,
                webClientId: this.resources.userPoolClient.userPoolClientId,
                identityPoolId: cfnIdentityPool.ref,
                authRegion: aws_cdk_lib_1.Stack.of(this).region,
            };
            // the properties below this line can be overwritten, so they are exposed via cdk LAZY
            output.allowUnauthenticatedIdentities = aws_cdk_lib_1.Lazy.string({
                produce: () => cfnIdentityPool.allowUnauthenticatedIdentities === true
                    ? 'true'
                    : 'false',
            });
            // extract signupAttributes from UserPool schema's required attributes
            output.signupAttributes = aws_cdk_lib_1.Lazy.string({
                produce: () => {
                    if (!cfnUserPool.schema) {
                        return '[]';
                    }
                    return JSON.stringify(cfnUserPool.schema
                        .filter((attribute) => attribute.required && attribute.name)
                        .map((attribute) => { var _a; return (_a = attribute.name) === null || _a === void 0 ? void 0 : _a.toLowerCase(); }));
                },
            });
            // extract usernameAttributes from UserPool's usernameAttributes
            output.usernameAttributes = aws_cdk_lib_1.Lazy.string({
                produce: () => {
                    var _a;
                    return JSON.stringify(((_a = cfnUserPool.usernameAttributes) === null || _a === void 0 ? void 0 : _a.map((attr) => attr.toLowerCase())) ||
                        []);
                },
            });
            // extract verificationMechanisms from UserPool's autoVerifiedAttributes
            output.verificationMechanisms = aws_cdk_lib_1.Lazy.string({
                produce: () => {
                    var _a;
                    return JSON.stringify((_a = cfnUserPool.autoVerifiedAttributes) !== null && _a !== void 0 ? _a : []);
                },
            });
            // extract the passwordPolicy from the UserPool policies
            output.passwordPolicyMinLength = aws_cdk_lib_1.Lazy.string({
                produce: () => {
                    var _a;
                    if (!cfnUserPool.policies) {
                        return '';
                    }
                    const policy = cfnUserPool.policies
                        .passwordPolicy;
                    return (_a = policy.minimumLength) === null || _a === void 0 ? void 0 : _a.toString();
                },
            });
            output.passwordPolicyRequirements = aws_cdk_lib_1.Lazy.string({
                produce: () => {
                    if (!cfnUserPool.policies) {
                        return '';
                    }
                    const policy = cfnUserPool.policies
                        .passwordPolicy;
                    const requirements = [];
                    policy.requireNumbers && requirements.push('REQUIRES_NUMBERS');
                    policy.requireLowercase && requirements.push('REQUIRES_LOWERCASE');
                    policy.requireUppercase && requirements.push('REQUIRES_UPPERCASE');
                    policy.requireSymbols && requirements.push('REQUIRES_SYMBOLS');
                    return JSON.stringify(requirements);
                },
            });
            // extract the MFA configuration setting from the UserPool resource
            output.mfaConfiguration = aws_cdk_lib_1.Lazy.string({
                produce: () => {
                    var _a;
                    return (_a = cfnUserPool.mfaConfiguration) !== null && _a !== void 0 ? _a : 'OFF';
                },
            });
            // extract the MFA types from the UserPool resource
            output.mfaTypes = aws_cdk_lib_1.Lazy.string({
                produce: () => {
                    var _a;
                    const enabledMfas = (_a = cfnUserPool.enabledMfas) !== null && _a !== void 0 ? _a : [];
                    const mfaTypes = [];
                    enabledMfas.forEach((type) => {
                        if (type === 'SMS_MFA') {
                            mfaTypes.push('SMS');
                        }
                        if (type === 'SOFTWARE_TOKEN_MFA') {
                            mfaTypes.push('TOTP');
                        }
                        if (type === 'EMAIL_OTP') {
                            mfaTypes.push('EMAIL');
                        }
                    });
                    return JSON.stringify(mfaTypes);
                },
            });
            // extract social providers from UserPool resource
            output.socialProviders = aws_cdk_lib_1.Lazy.string({
                produce: () => {
                    const outputProviders = [];
                    const userPoolProviders = this.resources.userPool.identityProviders;
                    if (!userPoolProviders || userPoolProviders.length === 0) {
                        return '';
                    }
                    for (const provider of userPoolProviders) {
                        const providerResource = provider.node.findChild('Resource');
                        if (!(providerResource instanceof aws_cognito_1.CfnUserPoolIdentityProvider)) {
                            throw Error('Could not find the CfnUserPoolIdentityProvider resource in the stack.');
                        }
                        const providerType = providerResource.providerType;
                        const providerName = providerResource.providerName;
                        if (providerType === 'Google') {
                            outputProviders.push('GOOGLE');
                        }
                        if (providerType === 'Facebook') {
                            outputProviders.push('FACEBOOK');
                        }
                        if (providerType === 'SignInWithApple') {
                            outputProviders.push('SIGN_IN_WITH_APPLE');
                        }
                        if (providerType === 'LoginWithAmazon') {
                            outputProviders.push('LOGIN_WITH_AMAZON');
                        }
                        if (providerType === 'OIDC') {
                            outputProviders.push(providerName);
                        }
                        if (providerType === 'SAML') {
                            outputProviders.push(providerName);
                        }
                    }
                    return JSON.stringify(outputProviders);
                },
            });
            output.oauthCognitoDomain = aws_cdk_lib_1.Lazy.string({
                produce: () => {
                    const userPoolDomain = this.resources.userPool.node.tryFindChild(`${this.name}UserPoolDomain`);
                    if (!userPoolDomain) {
                        return '';
                    }
                    if (!(userPoolDomain instanceof aws_cognito_1.UserPoolDomain)) {
                        throw Error('Could not find UserPoolDomain resource in the stack.');
                    }
                    return `${userPoolDomain.domainName}.auth.${aws_cdk_lib_1.Stack.of(this).region}.amazoncognito.com`;
                },
            });
            output.oauthScope = aws_cdk_lib_1.Lazy.string({
                produce: () => {
                    var _a;
                    return JSON.stringify((_a = cfnUserPoolClient.allowedOAuthScopes) !== null && _a !== void 0 ? _a : []);
                },
            });
            output.oauthRedirectSignIn = aws_cdk_lib_1.Lazy.string({
                produce: () => {
                    return cfnUserPoolClient.callbackUrLs
                        ? cfnUserPoolClient.callbackUrLs.join(',')
                        : '';
                },
            });
            output.oauthRedirectSignOut = aws_cdk_lib_1.Lazy.string({
                produce: () => {
                    return cfnUserPoolClient.logoutUrLs
                        ? cfnUserPoolClient.logoutUrLs.join(',')
                        : '';
                },
            });
            output.oauthResponseType = aws_cdk_lib_1.Lazy.string({
                produce: () => {
                    return cfnUserPoolClient.allowedOAuthFlows
                        ? cfnUserPoolClient.allowedOAuthFlows.join(',')
                        : '';
                },
            });
            output.oauthClientId = aws_cdk_lib_1.Lazy.string({
                produce: () => {
                    return cfnUserPoolClient.ref;
                },
            });
            // user group precedence can be overwritten, so they are exposed via cdk LAZY
            output.groups = aws_cdk_lib_1.Lazy.string({
                produce: () => {
                    const groupsArray = [];
                    Object.keys(this.resources.groups).forEach((groupName) => {
                        const precedence = this.resources.groups[groupName].cfnUserGroup.precedence;
                        groupsArray.push({
                            [groupName]: {
                                precedence,
                            },
                        });
                    }, {});
                    return JSON.stringify(groupsArray);
                },
            });
            outputStorageStrategy.addBackendOutputEntry(backend_output_schemas_1.authOutputKey, {
                version: '1',
                payload: output,
            });
        };
        this.name = (_a = props.name) !== null && _a !== void 0 ? _a : '';
        this.domainPrefix = (_b = props.loginWith.externalProviders) === null || _b === void 0 ? void 0 : _b.domainPrefix;
        // UserPool
        this.computedUserPoolProps = this.getUserPoolProps(props);
        this.userPool = new aws_cdk_lib_1.aws_cognito.UserPool(this, `${this.name}UserPool`, this.computedUserPoolProps);
        /**
         * Configure custom email sender for Cognito User Pool
         * Grant necessary permissions for Lambda function to decrypt emails
         * and allow Cognito to invoke the Lambda function
         */
        if (((_c = props.senders) === null || _c === void 0 ? void 0 : _c.email) &&
            'handler' in props.senders.email &&
            this.customSenderKMSkey) {
            this.customSenderKMSkey.grantDecrypt(props.senders.email.handler);
            this.customSenderKMSkey.grantEncrypt(props.senders.email.handler);
            this.userPool.addTrigger(aws_cognito_1.UserPoolOperation.of('customEmailSender'), props.senders.email.handler);
        }
        /**
         * Configure custom sms sender for Cognito User Pool
         * Grant necessary permissions for Lambda function to decrypt the requests
         * and allow Cognito to invoke the Lambda function
         */
        if (((_d = props.senders) === null || _d === void 0 ? void 0 : _d.sms) &&
            'handler' in props.senders.sms &&
            this.customSenderKMSkey) {
            this.customSenderKMSkey.grantDecrypt(props.senders.sms.handler);
            this.customSenderKMSkey.grantEncrypt(props.senders.sms.handler);
            this.userPool.addTrigger(aws_cognito_1.UserPoolOperation.of('customSmsSender'), props.senders.sms.handler);
        }
        // UserPool - External Providers (Oauth, SAML, OIDC) and User Pool Domain
        this.providerSetupResult = this.setupExternalProviders(this.userPool, props.loginWith);
        // UserPool Client
        const userPoolClient = new aws_cdk_lib_1.aws_cognito.UserPoolClient(this, `${this.name}UserPoolAppClient`, {
            userPool: this.userPool,
            authFlows: defaults_js_1.DEFAULTS.AUTH_FLOWS,
            preventUserExistenceErrors: defaults_js_1.DEFAULTS.PREVENT_USER_EXISTENCE_ERRORS,
            oAuth: this.providerSetupResult.oAuthSettings,
        });
        // Identity Pool
        const { identityPool, identityPoolRoleAttachment, roles: { auth, unAuth }, } = this.setupIdentityPool(this.userPool, userPoolClient, this.providerSetupResult);
        // Setup UserPool groups
        this.setupUserPoolGroups(props.groups, identityPool);
        const cfnUserPool = this.userPool.node.findChild('Resource');
        if (!(cfnUserPool instanceof aws_cognito_1.CfnUserPool)) {
            throw Error('Could not find CfnUserPool resource in stack.');
        }
        const cfnUserPoolClient = userPoolClient.node.findChild('Resource');
        if (!(cfnUserPoolClient instanceof aws_cognito_1.CfnUserPoolClient)) {
            throw Error('Could not find CfnUserPoolClient resource in stack.');
        }
        // expose resources
        this.resources = {
            userPool: this.userPool,
            userPoolClient,
            authenticatedUserIamRole: auth,
            unauthenticatedUserIamRole: unAuth,
            identityPoolId: identityPool.ref,
            cfnResources: {
                cfnUserPool,
                cfnUserPoolClient,
                cfnIdentityPool: identityPool,
                cfnIdentityPoolRoleAttachment: identityPoolRoleAttachment,
            },
            groups: this.groups,
        };
        this.storeOutput(props.outputStorageStrategy);
        new backend_output_storage_1.AttributionMetadataStorage().storeAttributionMetadata(aws_cdk_lib_1.Stack.of(this), authStackType, path.resolve(__dirname, '..', 'package.json'));
    }
    /**
     * Sanitize customer input and return Cognito User pool compatible Sms configurations
     */
    getSmsConfiguration(props) {
        if (!props || 'handler' in props) {
            // Either no configuration or custom sender is configured
            return undefined;
        }
        if ((props.snsCallerArn && !props.externalId) ||
            (!props.snsCallerArn && props.externalId)) {
            throw new Error('Both externalId and snsCallerArn are required when providing a custom IAM role. Ensure that your IAM role trust policy have an sts:ExternalId condition and is equal to the externalId value');
        }
        return {
            externalId: 'externalId' in props ? props.externalId : undefined,
            snsCallerArn: 'snsCallerArn' in props && props.snsCallerArn
                ? aws_iam_1.Role.fromRoleArn(this, `${this.name}SmsSenderRole`, props.snsCallerArn)
                : undefined,
            snsRegion: props.snsRegion,
            enableSMSRole: !!props,
        };
    }
    /**
     * Parses the user invitation settings and inserts codes/usernames where necessary.
     * @param settings the invitation settings
     * @returns cognito.UserInvitationConfig | undefined
     */
    getUserInvitationSettings(settings) {
        if (!settings) {
            return undefined;
        }
        return {
            emailSubject: settings.emailSubject,
            emailBody: settings.emailBody
                ? settings.emailBody(() => INVITATION_PLACEHOLDERS.USERNAME, () => INVITATION_PLACEHOLDERS.CODE)
                : undefined,
            smsMessage: settings.smsMessage
                ? settings.smsMessage(() => INVITATION_PLACEHOLDERS.USERNAME, () => INVITATION_PLACEHOLDERS.CODE)
                : undefined,
        };
    }
    /**
     * Verify the email body depending on if 'CODE' or 'LINK' style is used.
     * This ensures that the template contains the necessary placeholders for Cognito to insert verification codes or links.
     * @param emailSettings the provided email settings
     * @returns emailBody
     */
    verifyEmailBody(emailSettings) {
        let emailBody;
        if (emailSettings.verificationEmailBody &&
            emailSettings.verificationEmailStyle !== 'LINK') {
            emailBody = emailSettings.verificationEmailBody(() => VERIFICATION_EMAIL_PLACEHOLDERS.CODE);
            if (!emailBody.includes(VERIFICATION_EMAIL_PLACEHOLDERS.CODE)) {
                throw Error("Invalid email settings. Property 'verificationEmailBody' must utilize the 'code' parameter at least once as a placeholder for the verification code.");
            }
        }
        if (emailSettings.verificationEmailBody &&
            emailSettings.verificationEmailStyle === 'LINK') {
            let linkText = '';
            emailBody = emailSettings.verificationEmailBody((text) => {
                linkText = text
                    ? `{##${text}##}`
                    : VERIFICATION_EMAIL_PLACEHOLDERS.LINK;
                return linkText;
            });
            if (linkText === '' || !emailBody.includes(linkText)) {
                throw Error("Invalid email settings. Property 'verificationEmailBody' must utilize the 'link' parameter at least once as a placeholder for the verification link.");
            }
        }
        return emailBody;
    }
}
exports.AmplifyAuth = AmplifyAuth;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uc3RydWN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2NvbnN0cnVjdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FBdUM7QUFDdkMsNkNBS3FCO0FBTXJCLHlEQTBCaUM7QUFDakMsaURBQStEO0FBQy9ELGdGQUFnRjtBQVVoRiwrQ0FBeUM7QUFDekMsZ0ZBRzZDO0FBQzdDLDJDQUE2QjtBQUM3QixpREFBZ0Q7QUFtQmhELE1BQU0sZ0NBQWdDLEdBQXlCO0lBQzdELFFBQVEsRUFBRSxvQkFBb0I7SUFDOUIsTUFBTSxFQUFFLHFCQUFxQjtJQUM3QixNQUFNLEVBQUUsZ0JBQWdCO0lBQ3hCLEtBQUssRUFBRSxtQkFBbUI7Q0FDM0IsQ0FBQztBQUNGLE1BQU0sdUJBQXVCLEdBQUc7SUFDOUIsSUFBSSxFQUFFLFFBQVE7SUFDZCxRQUFRLEVBQUUsWUFBWTtDQUN2QixDQUFDO0FBQ0YsTUFBTSwrQkFBK0IsR0FBRztJQUN0QyxJQUFJLEVBQUUsUUFBUTtJQUNkLElBQUksRUFBRSxvQkFBb0I7Q0FDM0IsQ0FBQztBQUNGLE1BQU0sNkJBQTZCLEdBQUc7SUFDcEMsSUFBSSxFQUFFLFFBQVE7Q0FDZixDQUFDO0FBQ0YsTUFBTSxvQkFBb0IsR0FBRztJQUMzQixJQUFJLEVBQUUsUUFBUTtDQUNmLENBQUM7QUFDRixNQUFNLG9CQUFvQixHQUFHO0lBQzNCLHdCQUFVLENBQUMsS0FBSztJQUNoQix3QkFBVSxDQUFDLEtBQUs7SUFDaEIsd0JBQVUsQ0FBQyxNQUFNO0lBQ2pCLHdCQUFVLENBQUMsT0FBTztJQUNsQix3QkFBVSxDQUFDLGFBQWE7Q0FDekIsQ0FBQztBQUVGLHNIQUFzSDtBQUN0SCxNQUFNLGFBQWEsR0FBRyxjQUFjLENBQUM7QUFFckM7O0dBRUc7QUFDSCxNQUFhLFdBQ1gsU0FBUSxzQkFBUztJQWdDakI7OztPQUdHO0lBQ0gsWUFDRSxLQUFnQixF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LEdBQUcsRUFBRSxDQUFDLCtCQUErQixDQUFDLElBQUksQ0FDM0MsQ0FBQztZQUNGLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLCtCQUErQixDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7Z0JBQzlELE1BQU0sS0FBSyxDQUNULHNKQUFzSixDQUN2SixDQUFDO1lBQ0osQ0FBQztRQUNILENBQUM7UUFDRCxJQUNFLGFBQWEsQ0FBQyxxQkFBcUI7WUFDbkMsYUFBYSxDQUFDLHNCQUFzQixLQUFLLE1BQU0sRUFDL0MsQ0FBQztZQUNELElBQUksUUFBUSxHQUFXLEVBQUUsQ0FBQztZQUMxQixTQUFTLEdBQUcsYUFBYSxDQUFDLHFCQUFxQixDQUFDLENBQUMsSUFBYSxFQUFFLEVBQUU7Z0JBQ2hFLFFBQVEsR0FBRyxJQUFJO29CQUNiLENBQUMsQ0FBQyxNQUFNLElBQUksS0FBSztvQkFDakIsQ0FBQyxDQUFDLCtCQUErQixDQUFDLElBQUksQ0FBQztnQkFDekMsT0FBTyxRQUFRLENBQUM7WUFDbEIsQ0FBQyxDQUFDLENBQUM7WUFDSCxJQUFJLFFBQVEsS0FBSyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUM7Z0JBQ3JELE1BQU0sS0FBSyxDQUNULHNKQUFzSixDQUN2SixDQUFDO1lBQ0osQ0FBQztRQUNILENBQUM7UUFDRCxPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDO0NBb25CRjtBQTN1Q0Qsa0NBMnVDQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuaW1wb3J0IHtcbiAgTGF6eSxcbiAgUmVtb3ZhbFBvbGljeSxcbiAgU3RhY2ssXG4gIGF3c19jb2duaXRvIGFzIGNvZ25pdG8sXG59IGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCB7XG4gIEF1dGhSZXNvdXJjZXMsXG4gIEJhY2tlbmRPdXRwdXRTdG9yYWdlU3RyYXRlZ3ksXG4gIFJlc291cmNlUHJvdmlkZXIsXG59IGZyb20gJ0Bhd3MtYW1wbGlmeS9wbHVnaW4tdHlwZXMnO1xuaW1wb3J0IHtcbiAgQ2ZuSWRlbnRpdHlQb29sLFxuICBDZm5Vc2VyUG9vbCxcbiAgQ2ZuVXNlclBvb2xDbGllbnQsXG4gIENmblVzZXJQb29sR3JvdXAsXG4gIENmblVzZXJQb29sSWRlbnRpdHlQcm92aWRlcixcbiAgQ3VzdG9tQXR0cmlidXRlQ29uZmlnLFxuICBJQ3VzdG9tQXR0cmlidXRlLFxuICBNZmEsXG4gIE1mYVNlY29uZEZhY3RvcixcbiAgT0F1dGhTY29wZSxcbiAgT2lkY0F0dHJpYnV0ZVJlcXVlc3RNZXRob2QsXG4gIFByb3ZpZGVyQXR0cmlidXRlLFxuICBTdGFuZGFyZEF0dHJpYnV0ZSxcbiAgVXNlclBvb2wsXG4gIFVzZXJQb29sQ2xpZW50LFxuICBVc2VyUG9vbERvbWFpbixcbiAgVXNlclBvb2xJZGVudGl0eVByb3ZpZGVyQW1hem9uLFxuICBVc2VyUG9vbElkZW50aXR5UHJvdmlkZXJBcHBsZSxcbiAgVXNlclBvb2xJZGVudGl0eVByb3ZpZGVyRmFjZWJvb2ssXG4gIFVzZXJQb29sSWRlbnRpdHlQcm92aWRlckdvb2dsZSxcbiAgVXNlclBvb2xJZGVudGl0eVByb3ZpZGVyT2lkYyxcbiAgVXNlclBvb2xJZGVudGl0eVByb3ZpZGVyU2FtbCxcbiAgVXNlclBvb2xJZGVudGl0eVByb3ZpZGVyU2FtbE1ldGFkYXRhVHlwZSxcbiAgVXNlclBvb2xPcGVyYXRpb24sXG4gIFVzZXJQb29sUHJvcHMsXG59IGZyb20gJ2F3cy1jZGstbGliL2F3cy1jb2duaXRvJztcbmltcG9ydCB7IEZlZGVyYXRlZFByaW5jaXBhbCwgUm9sZSB9IGZyb20gJ2F3cy1jZGstbGliL2F3cy1pYW0nO1xuaW1wb3J0IHsgQXV0aE91dHB1dCwgYXV0aE91dHB1dEtleSB9IGZyb20gJ0Bhd3MtYW1wbGlmeS9iYWNrZW5kLW91dHB1dC1zY2hlbWFzJztcbmltcG9ydCB7XG4gIEF0dHJpYnV0ZU1hcHBpbmcsXG4gIEF1dGhQcm9wcyxcbiAgQ3VzdG9tQXR0cmlidXRlLFxuICBDdXN0b21TbXNTZW5kZXIsXG4gIEVtYWlsTG9naW5TZXR0aW5ncyxcbiAgRXh0ZXJuYWxQcm92aWRlck9wdGlvbnMsXG4gIFVzZXJQb29sU25zT3B0aW9ucyxcbn0gZnJvbSAnLi90eXBlcy5qcyc7XG5pbXBvcnQgeyBERUZBVUxUUyB9IGZyb20gJy4vZGVmYXVsdHMuanMnO1xuaW1wb3J0IHtcbiAgQXR0cmlidXRpb25NZXRhZGF0YVN0b3JhZ2UsXG4gIFN0YWNrTWV0YWRhdGFCYWNrZW5kT3V0cHV0U3RvcmFnZVN0cmF0ZWd5LFxufSBmcm9tICdAYXdzLWFtcGxpZnkvYmFja2VuZC1vdXRwdXQtc3RvcmFnZSc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgSUtleSwgS2V5IH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWttcyc7XG5cbnR5cGUgRGVmYXVsdFJvbGVzID0geyBhdXRoOiBSb2xlOyB1bkF1dGg6IFJvbGUgfTtcbnR5cGUgSWRlbnRpdHlQcm92aWRlclNldHVwUmVzdWx0ID0ge1xuICBvQXV0aE1hcHBpbmdzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xuICBvQXV0aFNldHRpbmdzOiBjb2duaXRvLk9BdXRoU2V0dGluZ3MgfCB1bmRlZmluZWQ7XG4gIGdvb2dsZT86IFVzZXJQb29sSWRlbnRpdHlQcm92aWRlckdvb2dsZTtcbiAgZmFjZWJvb2s/OiBVc2VyUG9vbElkZW50aXR5UHJvdmlkZXJGYWNlYm9vaztcbiAgYW1hem9uPzogVXNlclBvb2xJZGVudGl0eVByb3ZpZGVyQW1hem9uO1xuICBhcHBsZT86IFVzZXJQb29sSWRlbnRpdHlQcm92aWRlckFwcGxlO1xuICBvaWRjPzogVXNlclBvb2xJZGVudGl0eVByb3ZpZGVyT2lkY1tdO1xuICBzYW1sPzogVXNlclBvb2xJZGVudGl0eVByb3ZpZGVyU2FtbDtcbn07XG50eXBlIE9BdXRoUHJvdmlkZXJNYXBwaW5nID0ge1xuICBmYWNlYm9vazogc3RyaW5nO1xuICBnb29nbGU6IHN0cmluZztcbiAgYW1hem9uOiBzdHJpbmc7XG4gIGFwcGxlOiBzdHJpbmc7XG59O1xuY29uc3Qgb2F1dGhQcm92aWRlclRvUHJvdmlkZXJEb21haW5NYXA6IE9BdXRoUHJvdmlkZXJNYXBwaW5nID0ge1xuICBmYWNlYm9vazogJ2dyYXBoLmZhY2Vib29rLmNvbScsXG4gIGdvb2dsZTogJ2FjY291bnRzLmdvb2dsZS5jb20nLFxuICBhbWF6b246ICd3d3cuYW1hem9uLmNvbScsXG4gIGFwcGxlOiAnYXBwbGVpZC5hcHBsZS5jb20nLFxufTtcbmNvbnN0IElOVklUQVRJT05fUExBQ0VIT0xERVJTID0ge1xuICBDT0RFOiAneyMjIyN9JyxcbiAgVVNFUk5BTUU6ICd7dXNlcm5hbWV9Jyxcbn07XG5jb25zdCBWRVJJRklDQVRJT05fRU1BSUxfUExBQ0VIT0xERVJTID0ge1xuICBDT0RFOiAneyMjIyN9JyxcbiAgTElOSzogJ3sjI1ZlcmlmeSBFbWFpbCMjfScsXG59O1xuY29uc3QgVkVSSUZJQ0FUSU9OX1NNU19QTEFDRUhPTERFUlMgPSB7XG4gIENPREU6ICd7IyMjI30nLFxufTtcbmNvbnN0IE1GQV9TTVNfUExBQ0VIT0xERVJTID0ge1xuICBDT0RFOiAneyMjIyN9Jyxcbn07XG5jb25zdCBERUZBVUxUX09BVVRIX1NDT1BFUyA9IFtcbiAgT0F1dGhTY29wZS5QSE9ORSxcbiAgT0F1dGhTY29wZS5FTUFJTCxcbiAgT0F1dGhTY29wZS5PUEVOSUQsXG4gIE9BdXRoU2NvcGUuUFJPRklMRSxcbiAgT0F1dGhTY29wZS5DT0dOSVRPX0FETUlOLFxuXTtcblxuLy8gQmUgdmVyeSBjYXJlZnVsIGVkaXRpbmcgdGhpcyB2YWx1ZS4gSXQgaXMgdGhlIHN0cmluZyB0aGF0IGlzIHVzZWQgdG8gYXR0cmlidXRlIHN0YWNrcyB0byBBbXBsaWZ5IEF1dGggaW4gQkkgbWV0cmljc1xuY29uc3QgYXV0aFN0YWNrVHlwZSA9ICdhdXRoLUNvZ25pdG8nO1xuXG4vKipcbiAqIEFtcGxpZnkgQXV0aCBDREsgQ29uc3RydWN0XG4gKi9cbmV4cG9ydCBjbGFzcyBBbXBsaWZ5QXV0aFxuICBleHRlbmRzIENvbnN0cnVjdFxuICBpbXBsZW1lbnRzIFJlc291cmNlUHJvdmlkZXI8QXV0aFJlc291cmNlcz5cbntcbiAgLyoqXG4gICAqIFRoZSByZXNvdXJjZXMgZ2VuZXJhdGVkIGJ5IHRoZSBjb25zdHJ1Y3QuXG4gICAqL1xuICByZWFkb25seSByZXNvdXJjZXM6IEF1dGhSZXNvdXJjZXM7XG4gIC8qKlxuICAgKiBFeHRlcm5hbCBwcm92aWRlciBzZXR0aW5nc1xuICAgKi9cbiAgcHJpdmF0ZSByZWFkb25seSBwcm92aWRlclNldHVwUmVzdWx0OiBJZGVudGl0eVByb3ZpZGVyU2V0dXBSZXN1bHQ7XG5cbiAgcHJpdmF0ZSByZWFkb25seSB1c2VyUG9vbDogVXNlclBvb2w7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBjb21wdXRlZFVzZXJQb29sUHJvcHM6IFVzZXJQb29sUHJvcHM7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBuYW1lOiBzdHJpbmc7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBkb21haW5QcmVmaXg6IHN0cmluZyB8IHVuZGVmaW5lZDtcblxuICBwcml2YXRlIHJlYWRvbmx5IGdyb3Vwczoge1xuICAgIFtrZXk6IHN0cmluZ106IHtcbiAgICAgIGNmblVzZXJHcm91cDogQ2ZuVXNlclBvb2xHcm91cDtcbiAgICAgIHJvbGU6IFJvbGU7XG4gICAgfTtcbiAgfSA9IHt9O1xuICAvKipcbiAgICogVGhlIEtNUyBrZXkgdXNlZCBmb3IgZW5jcnlwdGluZyBjdXN0b20gZW1haWwgc2VuZGVyIGRhdGEuXG4gICAqIFRoaXMgaXMgb25seSBzZXQgd2hlbiB1c2luZyBhIGN1c3RvbSBlbWFpbCBzZW5kZXIuXG4gICAqL1xuICBwcml2YXRlIGN1c3RvbVNlbmRlcktNU2tleTogSUtleSB8IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogQ3JlYXRlIGEgbmV3IEF1dGggY29uc3RydWN0IHdpdGggQXV0aFByb3BzLlxuICAgKiBJZiBubyBwcm9wcyBhcmUgcHJvdmlkZWQsIGVtYWlsIGxvZ2luIGFuZCBkZWZhdWx0cyB3aWxsIGJlIHVzZWQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICBzY29wZTogQ29uc3RydWN0LFxuICAgIGlkOiBzdHJpbmcsXG4gICAgcHJvcHM6IEF1dGhQcm9wcyA9IERFRkFVTFRTLklGX05PX1BST1BTX1BST1ZJREVELFxuICApIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuICAgIHRoaXMubmFtZSA9IHByb3BzLm5hbWUgPz8gJyc7XG4gICAgdGhpcy5kb21haW5QcmVmaXggPSBwcm9wcy5sb2dpbldpdGguZXh0ZXJuYWxQcm92aWRlcnM/LmRvbWFpblByZWZpeDtcbiAgICAvLyBVc2VyUG9vbFxuICAgIHRoaXMuY29tcHV0ZWRVc2VyUG9vbFByb3BzID0gdGhpcy5nZXRVc2VyUG9vbFByb3BzKHByb3BzKTtcblxuICAgIHRoaXMudXNlclBvb2wgPSBuZXcgY29nbml0by5Vc2VyUG9vbChcbiAgICAgIHRoaXMsXG4gICAgICBgJHt0aGlzLm5hbWV9VXNlclBvb2xgLFxuICAgICAgdGhpcy5jb21wdXRlZFVzZXJQb29sUHJvcHMsXG4gICAgKTtcbiAgICAvKipcbiAgICAgKiBDb25maWd1cmUgY3VzdG9tIGVtYWlsIHNlbmRlciBmb3IgQ29nbml0byBVc2VyIFBvb2xcbiAgICAgKiBHcmFudCBuZWNlc3NhcnkgcGVybWlzc2lvbnMgZm9yIExhbWJkYSBmdW5jdGlvbiB0byBkZWNyeXB0IGVtYWlsc1xuICAgICAqIGFuZCBhbGxvdyBDb2duaXRvIHRvIGludm9rZSB0aGUgTGFtYmRhIGZ1bmN0aW9uXG4gICAgICovXG4gICAgaWYgKFxuICAgICAgcHJvcHMuc2VuZGVycz8uZW1haWwgJiZcbiAgICAgICdoYW5kbGVyJyBpbiBwcm9wcy5zZW5kZXJzLmVtYWlsICYmXG4gICAgICB0aGlzLmN1c3RvbVNlbmRlcktNU2tleVxuICAgICkge1xuICAgICAgdGhpcy5jdXN0b21TZW5kZXJLTVNrZXkuZ3JhbnREZWNyeXB0KHByb3BzLnNlbmRlcnMuZW1haWwuaGFuZGxlcik7XG4gICAgICB0aGlzLmN1c3RvbVNlbmRlcktNU2tleS5ncmFudEVuY3J5cHQocHJvcHMuc2VuZGVycy5lbWFpbC5oYW5kbGVyKTtcbiAgICAgIHRoaXMudXNlclBvb2wuYWRkVHJpZ2dlcihcbiAgICAgICAgVXNlclBvb2xPcGVyYXRpb24ub2YoJ2N1c3RvbUVtYWlsU2VuZGVyJyksXG4gICAgICAgIHByb3BzLnNlbmRlcnMuZW1haWwuaGFuZGxlcixcbiAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ29uZmlndXJlIGN1c3RvbSBzbXMgc2VuZGVyIGZvciBDb2duaXRvIFVzZXIgUG9vbFxuICAgICAqIEdyYW50IG5lY2Vzc2FyeSBwZXJtaXNzaW9ucyBmb3IgTGFtYmRhIGZ1bmN0aW9uIHRvIGRlY3J5cHQgdGhlIHJlcXVlc3RzXG4gICAgICogYW5kIGFsbG93IENvZ25pdG8gdG8gaW52b2tlIHRoZSBMYW1iZGEgZnVuY3Rpb25cbiAgICAgKi9cbiAgICBpZiAoXG4gICAgICBwcm9wcy5zZW5kZXJzPy5zbXMgJiZcbiAgICAgICdoYW5kbGVyJyBpbiBwcm9wcy5zZW5kZXJzLnNtcyAmJlxuICAgICAgdGhpcy5jdXN0b21TZW5kZXJLTVNrZXlcbiAgICApIHtcbiAgICAgIHRoaXMuY3VzdG9tU2VuZGVyS01Ta2V5LmdyYW50RGVjcnlwdChwcm9wcy5zZW5kZXJzLnNtcy5oYW5kbGVyKTtcbiAgICAgIHRoaXMuY3VzdG9tU2VuZGVyS01Ta2V5LmdyYW50RW5jcnlwdChwcm9wcy5zZW5kZXJzLnNtcy5oYW5kbGVyKTtcbiAgICAgIHRoaXMudXNlclBvb2wuYWRkVHJpZ2dlcihcbiAgICAgICAgVXNlclBvb2xPcGVyYXRpb24ub2YoJ2N1c3RvbVNtc1NlbmRlcicpLFxuICAgICAgICBwcm9wcy5zZW5kZXJzLnNtcy5oYW5kbGVyLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBVc2VyUG9vbCAtIEV4dGVybmFsIFByb3ZpZGVycyAoT2F1dGgsIFNBTUwsIE9JREMpIGFuZCBVc2VyIFBvb2wgRG9tYWluXG4gICAgdGhpcy5wcm92aWRlclNldHVwUmVzdWx0ID0gdGhpcy5zZXR1cEV4dGVybmFsUHJvdmlkZXJzKFxuICAgICAgdGhpcy51c2VyUG9vbCxcbiAgICAgIHByb3BzLmxvZ2luV2l0aCxcbiAgICApO1xuICAgIC8vIFVzZXJQb29sIENsaWVudFxuICAgIGNvbnN0IHVzZXJQb29sQ2xpZW50ID0gbmV3IGNvZ25pdG8uVXNlclBvb2xDbGllbnQoXG4gICAgICB0aGlzLFxuICAgICAgYCR7dGhpcy5uYW1lfVVzZXJQb29sQXBwQ2xpZW50YCxcbiAgICAgIHtcbiAgICAgICAgdXNlclBvb2w6IHRoaXMudXNlclBvb2wsXG4gICAgICAgIGF1dGhGbG93czogREVGQVVMVFMuQVVUSF9GTE9XUyxcbiAgICAgICAgcHJldmVudFVzZXJFeGlzdGVuY2VFcnJvcnM6IERFRkFVTFRTLlBSRVZFTlRfVVNFUl9FWElTVEVOQ0VfRVJST1JTLFxuICAgICAgICBvQXV0aDogdGhpcy5wcm92aWRlclNldHVwUmVzdWx0Lm9BdXRoU2V0dGluZ3MsXG4gICAgICB9LFxuICAgICk7XG5cbiAgICAvLyBJZGVudGl0eSBQb29sXG4gICAgY29uc3Qge1xuICAgICAgaWRlbnRpdHlQb29sLFxuICAgICAgaWRlbnRpdHlQb29sUm9sZUF0dGFjaG1lbnQsXG4gICAgICByb2xlczogeyBhdXRoLCB1bkF1dGggfSxcbiAgICB9ID0gdGhpcy5zZXR1cElkZW50aXR5UG9vbChcbiAgICAgIHRoaXMudXNlclBvb2wsXG4gICAgICB1c2VyUG9vbENsaWVudCxcbiAgICAgIHRoaXMucHJvdmlkZXJTZXR1cFJlc3VsdCxcbiAgICApO1xuXG4gICAgLy8gU2V0dXAgVXNlclBvb2wgZ3JvdXBzXG4gICAgdGhpcy5zZXR1cFVzZXJQb29sR3JvdXBzKHByb3BzLmdyb3VwcywgaWRlbnRpdHlQb29sKTtcblxuICAgIGNvbnN0IGNmblVzZXJQb29sID0gdGhpcy51c2VyUG9vbC5ub2RlLmZpbmRDaGlsZCgnUmVzb3VyY2UnKSBhcyBDZm5Vc2VyUG9vbDtcbiAgICBpZiAoIShjZm5Vc2VyUG9vbCBpbnN0YW5jZW9mIENmblVzZXJQb29sKSkge1xuICAgICAgdGhyb3cgRXJyb3IoJ0NvdWxkIG5vdCBmaW5kIENmblVzZXJQb29sIHJlc291cmNlIGluIHN0YWNrLicpO1xuICAgIH1cblxuICAgIGNvbnN0IGNmblVzZXJQb29sQ2xpZW50ID0gdXNlclBvb2xDbGllbnQubm9kZS5maW5kQ2hpbGQoXG4gICAgICAnUmVzb3VyY2UnLFxuICAgICkgYXMgQ2ZuVXNlclBvb2xDbGllbnQ7XG4gICAgaWYgKCEoY2ZuVXNlclBvb2xDbGllbnQgaW5zdGFuY2VvZiBDZm5Vc2VyUG9vbENsaWVudCkpIHtcbiAgICAgIHRocm93IEVycm9yKCdDb3VsZCBub3QgZmluZCBDZm5Vc2VyUG9vbENsaWVudCByZXNvdXJjZSBpbiBzdGFjay4nKTtcbiAgICB9XG4gICAgLy8gZXhwb3NlIHJlc291cmNlc1xuICAgIHRoaXMucmVzb3VyY2VzID0ge1xuICAgICAgdXNlclBvb2w6IHRoaXMudXNlclBvb2wsXG4gICAgICB1c2VyUG9vbENsaWVudCxcbiAgICAgIGF1dGhlbnRpY2F0ZWRVc2VySWFtUm9sZTogYXV0aCxcbiAgICAgIHVuYXV0aGVudGljYXRlZFVzZXJJYW1Sb2xlOiB1bkF1dGgsXG4gICAgICBpZGVudGl0eVBvb2xJZDogaWRlbnRpdHlQb29sLnJlZixcbiAgICAgIGNmblJlc291cmNlczoge1xuICAgICAgICBjZm5Vc2VyUG9vbCxcbiAgICAgICAgY2ZuVXNlclBvb2xDbGllbnQsXG4gICAgICAgIGNmbklkZW50aXR5UG9vbDogaWRlbnRpdHlQb29sLFxuICAgICAgICBjZm5JZGVudGl0eVBvb2xSb2xlQXR0YWNobWVudDogaWRlbnRpdHlQb29sUm9sZUF0dGFjaG1lbnQsXG4gICAgICB9LFxuICAgICAgZ3JvdXBzOiB0aGlzLmdyb3VwcyxcbiAgICB9O1xuICAgIHRoaXMuc3RvcmVPdXRwdXQocHJvcHMub3V0cHV0U3RvcmFnZVN0cmF0ZWd5KTtcblxuICAgIG5ldyBBdHRyaWJ1dGlvbk1ldGFkYXRhU3RvcmFnZSgpLnN0b3JlQXR0cmlidXRpb25NZXRhZGF0YShcbiAgICAgIFN0YWNrLm9mKHRoaXMpLFxuICAgICAgYXV0aFN0YWNrVHlwZSxcbiAgICAgIHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuLicsICdwYWNrYWdlLmpzb24nKSxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBBdXRoL1VuQXV0aCBSb2xlc1xuICAgKiBAcmV0dXJucyBEZWZhdWx0Um9sZXNcbiAgICovXG4gIHByaXZhdGUgc2V0dXBBdXRoQW5kVW5BdXRoUm9sZXMgPSAoaWRlbnRpdHlQb29sSWQ6IHN0cmluZyk6IERlZmF1bHRSb2xlcyA9PiB7XG4gICAgY29uc3QgcmVzdWx0OiBEZWZhdWx0Um9sZXMgPSB7XG4gICAgICBhdXRoOiBuZXcgUm9sZSh0aGlzLCBgJHt0aGlzLm5hbWV9YXV0aGVudGljYXRlZFVzZXJSb2xlYCwge1xuICAgICAgICBhc3N1bWVkQnk6IG5ldyBGZWRlcmF0ZWRQcmluY2lwYWwoXG4gICAgICAgICAgJ2NvZ25pdG8taWRlbnRpdHkuYW1hem9uYXdzLmNvbScsXG4gICAgICAgICAge1xuICAgICAgICAgICAgU3RyaW5nRXF1YWxzOiB7XG4gICAgICAgICAgICAgICdjb2duaXRvLWlkZW50aXR5LmFtYXpvbmF3cy5jb206YXVkJzogaWRlbnRpdHlQb29sSWQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJ0ZvckFueVZhbHVlOlN0cmluZ0xpa2UnOiB7XG4gICAgICAgICAgICAgICdjb2duaXRvLWlkZW50aXR5LmFtYXpvbmF3cy5jb206YW1yJzogJ2F1dGhlbnRpY2F0ZWQnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgICdzdHM6QXNzdW1lUm9sZVdpdGhXZWJJZGVudGl0eScsXG4gICAgICAgICksXG4gICAgICB9KSxcbiAgICAgIHVuQXV0aDogbmV3IFJvbGUodGhpcywgYCR7dGhpcy5uYW1lfXVuYXV0aGVudGljYXRlZFVzZXJSb2xlYCwge1xuICAgICAgICBhc3N1bWVkQnk6IG5ldyBGZWRlcmF0ZWRQcmluY2lwYWwoXG4gICAgICAgICAgJ2NvZ25pdG8taWRlbnRpdHkuYW1hem9uYXdzLmNvbScsXG4gICAgICAgICAge1xuICAgICAgICAgICAgU3RyaW5nRXF1YWxzOiB7XG4gICAgICAgICAgICAgICdjb2duaXRvLWlkZW50aXR5LmFtYXpvbmF3cy5jb206YXVkJzogaWRlbnRpdHlQb29sSWQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJ0ZvckFueVZhbHVlOlN0cmluZ0xpa2UnOiB7XG4gICAgICAgICAgICAgICdjb2duaXRvLWlkZW50aXR5LmFtYXpvbmF3cy5jb206YW1yJzogJ3VuYXV0aGVudGljYXRlZCcsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgJ3N0czpBc3N1bWVSb2xlV2l0aFdlYklkZW50aXR5JyxcbiAgICAgICAgKSxcbiAgICAgIH0pLFxuICAgIH07XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICAvKipcbiAgICogQXV0byBnZW5lcmF0ZSB0aGUgdXNlciBwb29sIGdyb3VwcyBhbmQgZ3JvdXAgcm9sZXNcbiAgICovXG4gIHByaXZhdGUgc2V0dXBVc2VyUG9vbEdyb3VwcyA9IChcbiAgICBncm91cHM6IHN0cmluZ1tdIHwgdW5kZWZpbmVkLFxuICAgIGlkZW50aXR5UG9vbDogQ2ZuSWRlbnRpdHlQb29sLFxuICApID0+IHtcbiAgICAoZ3JvdXBzIHx8IFtdKS5mb3JFYWNoKChncm91cE5hbWUsIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCBncm91cFJvbGUgPSBuZXcgUm9sZSh0aGlzLCBgJHt0aGlzLm5hbWV9JHtncm91cE5hbWV9R3JvdXBSb2xlYCwge1xuICAgICAgICBhc3N1bWVkQnk6IG5ldyBGZWRlcmF0ZWRQcmluY2lwYWwoXG4gICAgICAgICAgJ2NvZ25pdG8taWRlbnRpdHkuYW1hem9uYXdzLmNvbScsXG4gICAgICAgICAge1xuICAgICAgICAgICAgU3RyaW5nRXF1YWxzOiB7XG4gICAgICAgICAgICAgICdjb2duaXRvLWlkZW50aXR5LmFtYXpvbmF3cy5jb206YXVkJzogaWRlbnRpdHlQb29sLnJlZixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAnRm9yQW55VmFsdWU6U3RyaW5nTGlrZSc6IHtcbiAgICAgICAgICAgICAgJ2NvZ25pdG8taWRlbnRpdHkuYW1hem9uYXdzLmNvbTphbXInOiAnYXV0aGVudGljYXRlZCcsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgJ3N0czpBc3N1bWVSb2xlV2l0aFdlYklkZW50aXR5JyxcbiAgICAgICAgKSxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgY3VycmVudEdyb3VwID0gbmV3IENmblVzZXJQb29sR3JvdXAoXG4gICAgICAgIHRoaXMsXG4gICAgICAgIGAke3RoaXMubmFtZX0ke2dyb3VwTmFtZX1Hcm91cGAsXG4gICAgICAgIHtcbiAgICAgICAgICB1c2VyUG9vbElkOiB0aGlzLnVzZXJQb29sLnVzZXJQb29sSWQsXG4gICAgICAgICAgZ3JvdXBOYW1lOiBncm91cE5hbWUsXG4gICAgICAgICAgcm9sZUFybjogZ3JvdXBSb2xlLnJvbGVBcm4sXG4gICAgICAgICAgcHJlY2VkZW5jZTogaW5kZXgsXG4gICAgICAgIH0sXG4gICAgICApO1xuICAgICAgdGhpcy5ncm91cHNbZ3JvdXBOYW1lXSA9IHtcbiAgICAgICAgY2ZuVXNlckdyb3VwOiBjdXJyZW50R3JvdXAsXG4gICAgICAgIHJvbGU6IGdyb3VwUm9sZSxcbiAgICAgIH07XG4gICAgfSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFNldHVwIElkZW50aXR5IFBvb2wgd2l0aCBkZWZhdWx0IHJvbGVzL3JvbGUgbWFwcGluZ3MsIGFuZCByZWdpc3RlciBwcm92aWRlcnNcbiAgICovXG4gIHByaXZhdGUgc2V0dXBJZGVudGl0eVBvb2wgPSAoXG4gICAgdXNlclBvb2w6IFVzZXJQb29sLFxuICAgIHVzZXJQb29sQ2xpZW50OiBVc2VyUG9vbENsaWVudCxcbiAgICBwcm92aWRlclNldHVwUmVzdWx0OiBJZGVudGl0eVByb3ZpZGVyU2V0dXBSZXN1bHQsXG4gICkgPT4ge1xuICAgIC8vIHNldHVwIGlkZW50aXR5IHBvb2xcbiAgICBjb25zdCByZWdpb24gPSBTdGFjay5vZih0aGlzKS5yZWdpb247XG4gICAgY29uc3QgaWRlbnRpdHlQb29sID0gbmV3IGNvZ25pdG8uQ2ZuSWRlbnRpdHlQb29sKFxuICAgICAgdGhpcyxcbiAgICAgIGAke3RoaXMubmFtZX1JZGVudGl0eVBvb2xgLFxuICAgICAge1xuICAgICAgICBhbGxvd1VuYXV0aGVudGljYXRlZElkZW50aXRpZXM6XG4gICAgICAgICAgREVGQVVMVFMuQUxMT1dfVU5BVVRIRU5USUNBVEVEX0lERU5USVRJRVMsXG4gICAgICB9LFxuICAgICk7XG4gICAgY29uc3Qgcm9sZXMgPSB0aGlzLnNldHVwQXV0aEFuZFVuQXV0aFJvbGVzKGlkZW50aXR5UG9vbC5yZWYpO1xuICAgIGNvbnN0IGlkZW50aXR5UG9vbFJvbGVBdHRhY2htZW50ID1cbiAgICAgIG5ldyBjb2duaXRvLkNmbklkZW50aXR5UG9vbFJvbGVBdHRhY2htZW50KFxuICAgICAgICB0aGlzLFxuICAgICAgICBgJHt0aGlzLm5hbWV9SWRlbnRpdHlQb29sUm9sZUF0dGFjaG1lbnRgLFxuICAgICAgICB7XG4gICAgICAgICAgaWRlbnRpdHlQb29sSWQ6IGlkZW50aXR5UG9vbC5yZWYsXG4gICAgICAgICAgcm9sZXM6IHtcbiAgICAgICAgICAgIHVuYXV0aGVudGljYXRlZDogcm9sZXMudW5BdXRoLnJvbGVBcm4sXG4gICAgICAgICAgICBhdXRoZW50aWNhdGVkOiByb2xlcy5hdXRoLnJvbGVBcm4sXG4gICAgICAgICAgfSxcbiAgICAgICAgICByb2xlTWFwcGluZ3M6IHtcbiAgICAgICAgICAgIFVzZXJQb29sV2ViQ2xpZW50Um9sZU1hcHBpbmc6IHtcbiAgICAgICAgICAgICAgdHlwZTogJ1Rva2VuJyxcbiAgICAgICAgICAgICAgYW1iaWd1b3VzUm9sZVJlc29sdXRpb246ICdBdXRoZW50aWNhdGVkUm9sZScsXG4gICAgICAgICAgICAgIGlkZW50aXR5UHJvdmlkZXI6IGBjb2duaXRvLWlkcC4ke3JlZ2lvbn0uYW1hem9uYXdzLmNvbS8ke3VzZXJQb29sLnVzZXJQb29sSWR9OiR7dXNlclBvb2xDbGllbnQudXNlclBvb2xDbGllbnRJZH1gLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgKTtcbiAgICBpZGVudGl0eVBvb2xSb2xlQXR0YWNobWVudC5hZGREZXBlbmRlbmN5KGlkZW50aXR5UG9vbCk7XG4gICAgaWRlbnRpdHlQb29sUm9sZUF0dGFjaG1lbnQubm9kZS5hZGREZXBlbmRlbmN5KHVzZXJQb29sQ2xpZW50KTtcbiAgICAvLyBhZGQgY29nbml0byBwcm92aWRlclxuICAgIGlkZW50aXR5UG9vbC5jb2duaXRvSWRlbnRpdHlQcm92aWRlcnMgPSBbXG4gICAgICB7XG4gICAgICAgIGNsaWVudElkOiB1c2VyUG9vbENsaWVudC51c2VyUG9vbENsaWVudElkLFxuICAgICAgICBwcm92aWRlck5hbWU6IGBjb2duaXRvLWlkcC4ke3JlZ2lvbn0uYW1hem9uYXdzLmNvbS8ke3VzZXJQb29sLnVzZXJQb29sSWR9YCxcbiAgICAgIH0sXG4gICAgXTtcbiAgICAvLyBhZGQgb3RoZXIgcHJvdmlkZXJzXG4gICAgaWRlbnRpdHlQb29sLnN1cHBvcnRlZExvZ2luUHJvdmlkZXJzID0gcHJvdmlkZXJTZXR1cFJlc3VsdC5vQXV0aE1hcHBpbmdzO1xuICAgIHJldHVybiB7XG4gICAgICBpZGVudGl0eVBvb2wsXG4gICAgICBpZGVudGl0eVBvb2xSb2xlQXR0YWNobWVudCxcbiAgICAgIHJvbGVzLFxuICAgIH07XG4gIH07XG5cbiAgLyoqXG4gICAqIERlZmluZSBiaW5kQ3VzdG9tQXR0cmlidXRlIHRvIG1lZXQgcmVxdWlyZW1lbnRzIG9mIHRoZSBDb2duaXRvIEFQSSB0byBjYWxsIHRoZSBiaW5kIG1ldGhvZFxuICAgKi9cbiAgcHJpdmF0ZSBiaW5kQ3VzdG9tQXR0cmlidXRlID0gKFxuICAgIGtleTogc3RyaW5nLFxuICAgIGF0dHJpYnV0ZTogQ3VzdG9tQXR0cmlidXRlLFxuICApOiBDdXN0b21BdHRyaWJ1dGVDb25maWcgJiBJQ3VzdG9tQXR0cmlidXRlID0+IHtcbiAgICBjb25zdCBiYXNlQ29uZmlnOiBDdXN0b21BdHRyaWJ1dGVDb25maWcgPSB7XG4gICAgICBkYXRhVHlwZTogYXR0cmlidXRlLmRhdGFUeXBlLFxuXG4gICAgICBtdXRhYmxlOiBhdHRyaWJ1dGUubXV0YWJsZSA/PyB0cnVlLFxuICAgIH07XG5cbiAgICBsZXQgY29uc3RyYWludHMgPSB7fTtcbiAgICAvLyBDb25kaXRpb25hbGx5IGFkZCBjb25zdHJhaW50IHByb3BlcnRpZXMgYmFzZWQgb24gZGF0YVR5cGUuXG4gICAgaWYgKGF0dHJpYnV0ZS5kYXRhVHlwZSA9PT0gJ1N0cmluZycpIHtcbiAgICAgIGNvbnN0cmFpbnRzID0ge1xuICAgICAgICBzdHJpbmdDb25zdHJhaW50czoge1xuICAgICAgICAgIG1pbkxlbjogYXR0cmlidXRlLm1pbkxlbixcblxuICAgICAgICAgIG1heExlbjogYXR0cmlidXRlLm1heExlbixcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfSBlbHNlIGlmIChhdHRyaWJ1dGUuZGF0YVR5cGUgPT09ICdOdW1iZXInKSB7XG4gICAgICBjb25zdHJhaW50cyA9IHtcbiAgICAgICAgbnVtYmVyQ29uc3RyYWludHM6IHtcbiAgICAgICAgICBtaW46IGF0dHJpYnV0ZS5taW4sXG5cbiAgICAgICAgICBtYXg6IGF0dHJpYnV0ZS5tYXgsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH1cbiAgICAvL1RoZSBmaW5hbCBjb25maWcgb2JqZWN0IGluY2x1ZGVzIGJhc2VDb25maWcgYW5kIGNvbmRpdGlvbmFsbHkgYWRkZWQgY29uc3RyYWludCBwcm9wZXJ0aWVzLlxuICAgIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgIC4uLmJhc2VDb25maWcsXG5cbiAgICAgIC4uLmNvbnN0cmFpbnRzLFxuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgLi4uY29uZmlnLFxuXG4gICAgICBiaW5kOiAoKSA9PiBjb25maWcsXG4gICAgfTtcbiAgfTtcbiAgLyoqXG4gICAqIFByb2Nlc3MgcHJvcHMgaW50byBVc2VyUG9vbFByb3BzIChzZXQgZGVmYXVsdHMgaWYgbmVlZGVkKVxuICAgKi9cbiAgcHJpdmF0ZSBnZXRVc2VyUG9vbFByb3BzID0gKHByb3BzOiBBdXRoUHJvcHMpOiBVc2VyUG9vbFByb3BzID0+IHtcbiAgICBjb25zdCBlbWFpbEVuYWJsZWQgPSBwcm9wcy5sb2dpbldpdGguZW1haWwgPyB0cnVlIDogZmFsc2U7XG4gICAgY29uc3QgcGhvbmVFbmFibGVkID0gcHJvcHMubG9naW5XaXRoLnBob25lID8gdHJ1ZSA6IGZhbHNlO1xuICAgIGNvbnN0IG9uZU9mRW1haWxPclBob25lID0gZW1haWxFbmFibGVkIHx8IHBob25lRW5hYmxlZDtcbiAgICBpZiAoIW9uZU9mRW1haWxPclBob25lKSB7XG4gICAgICB0aHJvdyBFcnJvcignQXQgbGVhc3Qgb25lIG9mIGVtYWlsIG9yIHBob25lIG11c3QgYmUgZW5hYmxlZC4nKTtcbiAgICB9XG4gICAgbGV0IHVzZXJWZXJpZmljYXRpb25TZXR0aW5nczogY29nbml0by5Vc2VyVmVyaWZpY2F0aW9uQ29uZmlnID0ge307XG4gICAgLy8gZXh0cmFjdCBlbWFpbCBzZXR0aW5ncyBpZiBzZXR0aW5ncyBvYmplY3QgaXMgZGVmaW5lZFxuICAgIGlmICh0eXBlb2YgcHJvcHMubG9naW5XaXRoLmVtYWlsID09PSAnb2JqZWN0Jykge1xuICAgICAgY29uc3QgZW1haWxTZXR0aW5ncyA9IHByb3BzLmxvZ2luV2l0aC5lbWFpbDtcbiAgICAgIC8vIHZlcmlmeSBlbWFpbCBib2R5IGFuZCBpbmplY3QgdGhlIGFjdHVhbCB0ZW1wbGF0ZSB2YWx1ZXMgd2hpY2ggY29nbml0byB1c2VzXG4gICAgICBjb25zdCBlbWFpbEJvZHk6IHN0cmluZyB8IHVuZGVmaW5lZCA9IHRoaXMudmVyaWZ5RW1haWxCb2R5KGVtYWlsU2V0dGluZ3MpO1xuICAgICAgdXNlclZlcmlmaWNhdGlvblNldHRpbmdzID0ge1xuICAgICAgICBlbWFpbEJvZHk6IGVtYWlsQm9keSxcbiAgICAgICAgZW1haWxTdHlsZTogdGhpcy5nZXRFbWFpbFZlcmlmaWNhdGlvblN0eWxlKFxuICAgICAgICAgIGVtYWlsU2V0dGluZ3MudmVyaWZpY2F0aW9uRW1haWxTdHlsZSxcbiAgICAgICAgKSxcbiAgICAgICAgZW1haWxTdWJqZWN0OiBlbWFpbFNldHRpbmdzLnZlcmlmaWNhdGlvbkVtYWlsU3ViamVjdCxcbiAgICAgIH07XG4gICAgfVxuICAgIC8vIGV4dHJhY3QgcGhvbmUgc2V0dGluZ3MgaWYgc2V0dGluZ3Mgb2JqZWN0IGlzIGRlZmluZWRcbiAgICBpZiAodHlwZW9mIHByb3BzLmxvZ2luV2l0aC5waG9uZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgIGNvbnN0IHBob25lU2V0dGluZ3MgPSBwcm9wcy5sb2dpbldpdGgucGhvbmU7XG4gICAgICBsZXQgc21zTWVzc2FnZTogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgICAgaWYgKFxuICAgICAgICBwaG9uZVNldHRpbmdzLnZlcmlmaWNhdGlvbk1lc3NhZ2UgJiZcbiAgICAgICAgdHlwZW9mIHBob25lU2V0dGluZ3MudmVyaWZpY2F0aW9uTWVzc2FnZSA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgKSB7XG4gICAgICAgIC8vIHZhbGlkYXRlIHNtcyBtZXNzYWdlIHN0cnVjdHVyZVxuICAgICAgICBzbXNNZXNzYWdlID0gcGhvbmVTZXR0aW5ncy52ZXJpZmljYXRpb25NZXNzYWdlKFxuICAgICAgICAgICgpID0+IFZFUklGSUNBVElPTl9TTVNfUExBQ0VIT0xERVJTLkNPREUsXG4gICAgICAgICk7XG4gICAgICAgIGlmICghc21zTWVzc2FnZS5pbmNsdWRlcyhWRVJJRklDQVRJT05fU01TX1BMQUNFSE9MREVSUy5DT0RFKSkge1xuICAgICAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgICAgXCJJbnZhbGlkIHBob25lIHNldHRpbmdzLiBQcm9wZXJ0eSAndmVyaWZpY2F0aW9uTWVzc2FnZScgbXVzdCB1dGlsaXplIHRoZSAnY29kZScgcGFyYW1ldGVyIGF0IGxlYXN0IG9uY2UgYXMgYSBwbGFjZWhvbGRlciBmb3IgdGhlIHZlcmlmaWNhdGlvbiBjb2RlLlwiLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHVzZXJWZXJpZmljYXRpb25TZXR0aW5ncyA9IHtcbiAgICAgICAgLi4udXNlclZlcmlmaWNhdGlvblNldHRpbmdzLFxuICAgICAgICBzbXNNZXNzYWdlOiBzbXNNZXNzYWdlLFxuICAgICAgfTtcbiAgICB9XG4gICAgY29uc3QgbWZhVHlwZSA9IHRoaXMuZ2V0TUZBVHlwZShwcm9wcy5tdWx0aWZhY3Rvcik7XG4gICAgY29uc3QgbWZhTW9kZSA9IHRoaXMuZ2V0TUZBTW9kZShwcm9wcy5tdWx0aWZhY3Rvcik7XG5cbiAgICAvLyBJZiBwaG9uZSBsb2dpbiBpcyBlbmFibGVkIGFsb25nIHdpdGggTUZBLCBjb2duaXRvIHJlcXVpcmVzIHRoYXQgbWZhIFNNUyB0eXBlIHRvIGJlIGVuYWJsZWQuXG4gICAgaWYgKHBob25lRW5hYmxlZCAmJiBtZmFNb2RlICYmIG1mYU1vZGUgIT09ICdPRkYnICYmICFtZmFUeXBlPy5zbXMpIHtcbiAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAnSW52YWxpZCBNRkEgc2V0dGluZ3MuIFNNUyBtdXN0IGJlIGVuYWJsZWQgaW4gbXVsdGlGYWN0b3IgaWYgbG9naW5XaXRoIHBob25lIGlzIGVuYWJsZWQnLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCB7IHN0YW5kYXJkQXR0cmlidXRlcywgY3VzdG9tQXR0cmlidXRlcyB9ID0gT2JqZWN0LmVudHJpZXMoXG4gICAgICBwcm9wcy51c2VyQXR0cmlidXRlcyA/PyB7fSxcbiAgICApLnJlZHVjZShcbiAgICAgIChcbiAgICAgICAgYWNjOiB7XG4gICAgICAgICAgc3RhbmRhcmRBdHRyaWJ1dGVzOiB7IFtrZXk6IHN0cmluZ106IFN0YW5kYXJkQXR0cmlidXRlIH07XG4gICAgICAgICAgY3VzdG9tQXR0cmlidXRlczoge1xuICAgICAgICAgICAgW2tleTogc3RyaW5nXTogQ3VzdG9tQXR0cmlidXRlQ29uZmlnICYgSUN1c3RvbUF0dHJpYnV0ZTtcbiAgICAgICAgICB9O1xuICAgICAgICB9LFxuICAgICAgICBba2V5LCB2YWx1ZV0sXG4gICAgICApID0+IHtcbiAgICAgICAgaWYgKGtleS5zdGFydHNXaXRoKCdjdXN0b206JykpIHtcbiAgICAgICAgICBjb25zdCBhdHRyaWJ1dGVLZXkgPSBrZXkucmVwbGFjZSgvXmN1c3RvbTovaSwgJycpO1xuICAgICAgICAgIGFjYy5jdXN0b21BdHRyaWJ1dGVzW2F0dHJpYnV0ZUtleV0gPSB0aGlzLmJpbmRDdXN0b21BdHRyaWJ1dGUoXG4gICAgICAgICAgICBhdHRyaWJ1dGVLZXksXG4gICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFjYy5zdGFuZGFyZEF0dHJpYnV0ZXNba2V5XSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgICB9LFxuICAgICAgeyBzdGFuZGFyZEF0dHJpYnV0ZXM6IHt9LCBjdXN0b21BdHRyaWJ1dGVzOiB7fSB9LFxuICAgICk7XG4gICAgLyoqXG4gICAgICogSGFuZGxlIEtNUyBrZXkgZm9yIGN1c3RvbSBlbWFpbCBhbmQgc21zIHNlbmRlcnNcbiAgICAgKiBJZiBhIGN1c3RvbSBzZW5kZXIgaXMgcHJvdmlkZWQsIHdlIGVpdGhlciB1c2UgdGhlIHByb3ZpZGVkIEtNUyBrZXkgQVJOXG4gICAgICogb3IgY3JlYXRlIGEgbmV3IEtNUyBrZXkgaWYgb25lIGlzIG5vdCBwcm92aWRlZC5cbiAgICAgKlxuICAgICAqIElmIEtNUyBrZXkgaXMgcHJvdmlkZWQgaW4gYm90aCBzZW5kZXJzLCB3ZSB0aHJvdyBhbiBlcnJvclxuICAgICAqL1xuICAgIGlmIChwcm9wcy5zZW5kZXJzKSB7XG4gICAgICBjb25zdCBjdXN0b21TbXNTZW5kZXIgPVxuICAgICAgICBwcm9wcy5zZW5kZXJzLnNtcyAmJiAnaGFuZGxlcicgaW4gcHJvcHMuc2VuZGVycy5zbXNcbiAgICAgICAgICA/IHByb3BzLnNlbmRlcnMuc21zXG4gICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgICBjb25zdCBjdXN0b21FbWFpbFNlbmRlciA9XG4gICAgICAgIHByb3BzLnNlbmRlcnMuZW1haWwgJiYgJ2hhbmRsZXInIGluIHByb3BzLnNlbmRlcnMuZW1haWxcbiAgICAgICAgICA/IHByb3BzLnNlbmRlcnMuZW1haWxcbiAgICAgICAgICA6IHVuZGVmaW5lZDtcbiAgICAgIC8vIElmIGJvdGggY3VzdG9tIHNlbmRlcnMgYXJlIGNvbmZpZ3VyZWQgYW5kIGRvbid0IHByb3ZpZGUgc2FtZSBLTVMgS2V5LCB0aGVuIHRocm93XG4gICAgICBpZiAoXG4gICAgICAgIGN1c3RvbVNtc1NlbmRlciAmJlxuICAgICAgICBjdXN0b21FbWFpbFNlbmRlciAmJlxuICAgICAgICBjdXN0b21TbXNTZW5kZXIua21zS2V5QXJuICYmXG4gICAgICAgIGN1c3RvbUVtYWlsU2VuZGVyLmttc0tleUFybiAmJlxuICAgICAgICBjdXN0b21TbXNTZW5kZXIua21zS2V5QXJuICE9PSBjdXN0b21FbWFpbFNlbmRlci5rbXNLZXlBcm5cbiAgICAgICkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ0tNUyBrZXkgQVJOIG11c3QgYmUgdGhlIHNhbWUgZm9yIGJvdGggZW1haWwgYW5kIHNtcyBzZW5kZXJzJyxcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIChjdXN0b21TbXNTZW5kZXIgJiYgY3VzdG9tU21zU2VuZGVyLmttc0tleUFybikgfHxcbiAgICAgICAgKGN1c3RvbUVtYWlsU2VuZGVyICYmIGN1c3RvbUVtYWlsU2VuZGVyLmttc0tleUFybilcbiAgICAgICkge1xuICAgICAgICAvLyBJZiBhdCBsZWFzdCBvbmUgY3VzdG9tIHNlbmRlciBpcyBjb25maWd1cmVkIHdpdGggS01TIGtleSwgd2UgdXNlIGl0XG4gICAgICAgIGNvbnN0IGttc0tleUFybiA9XG4gICAgICAgICAgY3VzdG9tU21zU2VuZGVyPy5rbXNLZXlBcm4gPz8gY3VzdG9tRW1haWxTZW5kZXI/Lmttc0tleUFybjtcbiAgICAgICAgdGhpcy5jdXN0b21TZW5kZXJLTVNrZXkgPSBLZXkuZnJvbUtleUFybihcbiAgICAgICAgICB0aGlzLFxuICAgICAgICAgIGAke3RoaXMubmFtZX1DdXN0b21TZW5kZXJLZXlgLFxuICAgICAgICAgIGttc0tleUFybiEsIC8vIEluIGlmIGNvbmRpdGlvbiB3ZSBlbnN1cmUgdGhhdCBhdCBsZXN0IG9uZSBvZiB0aGUga2V5IGlzIGF2YWlsYWJsZVxuICAgICAgICApO1xuICAgICAgfSBlbHNlIGlmIChjdXN0b21TbXNTZW5kZXIgfHwgY3VzdG9tRW1haWxTZW5kZXIpIHtcbiAgICAgICAge1xuICAgICAgICAgIC8vIElmIGF0IGxlYXN0IG9uZSBjdXN0b20gc2VuZGVyIGlzIGNvbmZpZ3VyZWQgYnV0IG5vIEtNUyBrZXkgcHJvdmlkZWQsIHdlIGNyZWF0ZSBvbmUuXG4gICAgICAgICAgdGhpcy5jdXN0b21TZW5kZXJLTVNrZXkgPSBuZXcgS2V5KFxuICAgICAgICAgICAgY3VzdG9tU21zU2VuZGVyXG4gICAgICAgICAgICAgID8gY3VzdG9tU21zU2VuZGVyLmhhbmRsZXIuc3RhY2tcbiAgICAgICAgICAgICAgOiBjdXN0b21FbWFpbFNlbmRlciEuaGFuZGxlci5zdGFjaywgLy8gSW4gaWYgY29uZGl0aW9uIHdlIGVuc3VyZSB0aGF0IGF0IGxlc3Qgb25lIG9mIHRoZSBoYW5kbGVyIGlzIGF2YWlsYWJsZVxuICAgICAgICAgICAgYCR7dGhpcy5uYW1lfUN1c3RvbVNlbmRlcktleWAsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGVuYWJsZUtleVJvdGF0aW9uOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IHNtc0NvbmZpZ3VyYXRpb24gPSB0aGlzLmdldFNtc0NvbmZpZ3VyYXRpb24ocHJvcHMuc2VuZGVycz8uc21zKTtcbiAgICBjb25zdCB1c2VyUG9vbFByb3BzOiBVc2VyUG9vbFByb3BzID0ge1xuICAgICAgc2lnbkluQ2FzZVNlbnNpdGl2ZTogREVGQVVMVFMuU0lHTl9JTl9DQVNFX1NFTlNJVElWRSxcbiAgICAgIHNpZ25JbkFsaWFzZXM6IHtcbiAgICAgICAgcGhvbmU6IHBob25lRW5hYmxlZCxcbiAgICAgICAgZW1haWw6IGVtYWlsRW5hYmxlZCxcbiAgICAgIH0sXG4gICAgICBrZWVwT3JpZ2luYWw6IHtcbiAgICAgICAgZW1haWw6IGVtYWlsRW5hYmxlZCxcbiAgICAgICAgcGhvbmU6IHBob25lRW5hYmxlZCxcbiAgICAgIH0sXG4gICAgICBhdXRvVmVyaWZ5OiB7XG4gICAgICAgIGVtYWlsOiBlbWFpbEVuYWJsZWQsXG4gICAgICAgIHBob25lOiBwaG9uZUVuYWJsZWQsXG4gICAgICB9LFxuICAgICAgdXNlclZlcmlmaWNhdGlvbjogdXNlclZlcmlmaWNhdGlvblNldHRpbmdzLFxuICAgICAgcGFzc3dvcmRQb2xpY3k6IERFRkFVTFRTLlBBU1NXT1JEX1BPTElDWSxcbiAgICAgIHN0YW5kYXJkQXR0cmlidXRlczoge1xuICAgICAgICBlbWFpbDogREVGQVVMVFMuSVNfUkVRVUlSRURfQVRUUklCVVRFLmVtYWlsKGVtYWlsRW5hYmxlZCksXG4gICAgICAgIHBob25lTnVtYmVyOiBERUZBVUxUUy5JU19SRVFVSVJFRF9BVFRSSUJVVEUucGhvbmVOdW1iZXIocGhvbmVFbmFibGVkKSxcbiAgICAgICAgLi4uc3RhbmRhcmRBdHRyaWJ1dGVzLFxuICAgICAgfSxcbiAgICAgIGN1c3RvbUF0dHJpYnV0ZXM6IHtcbiAgICAgICAgLi4uY3VzdG9tQXR0cmlidXRlcyxcbiAgICAgIH0sXG4gICAgICBlbWFpbDpcbiAgICAgICAgcHJvcHMuc2VuZGVycz8uZW1haWwgJiYgJ2Zyb21FbWFpbCcgaW4gcHJvcHMuc2VuZGVycy5lbWFpbFxuICAgICAgICAgID8gY29nbml0by5Vc2VyUG9vbEVtYWlsLndpdGhTRVMoe1xuICAgICAgICAgICAgICBmcm9tRW1haWw6IHByb3BzLnNlbmRlcnMuZW1haWwuZnJvbUVtYWlsLFxuICAgICAgICAgICAgICBmcm9tTmFtZTogcHJvcHMuc2VuZGVycy5lbWFpbC5mcm9tTmFtZSxcbiAgICAgICAgICAgICAgcmVwbHlUbzogcHJvcHMuc2VuZGVycy5lbWFpbC5yZXBseVRvLFxuICAgICAgICAgICAgICBzZXNSZWdpb246IFN0YWNrLm9mKHRoaXMpLnJlZ2lvbixcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICBzbXNSb2xlOiBzbXNDb25maWd1cmF0aW9uPy5zbnNDYWxsZXJBcm4sXG4gICAgICBzbXNSb2xlRXh0ZXJuYWxJZDogc21zQ29uZmlndXJhdGlvbj8uZXh0ZXJuYWxJZCxcbiAgICAgIHNuc1JlZ2lvbjogc21zQ29uZmlndXJhdGlvbj8uc25zUmVnaW9uLFxuICAgICAgZW5hYmxlU21zUm9sZTogc21zQ29uZmlndXJhdGlvbj8uZW5hYmxlU01TUm9sZSxcbiAgICAgIHNlbGZTaWduVXBFbmFibGVkOiBERUZBVUxUUy5BTExPV19TRUxGX1NJR05fVVAsXG4gICAgICBtZmE6IG1mYU1vZGUsXG4gICAgICBtZmFNZXNzYWdlOiB0aGlzLmdldE1GQU1lc3NhZ2UocHJvcHMubXVsdGlmYWN0b3IpLFxuICAgICAgbWZhU2Vjb25kRmFjdG9yOiBtZmFUeXBlLFxuICAgICAgYWNjb3VudFJlY292ZXJ5OiB0aGlzLmdldEFjY291bnRSZWNvdmVyeVNldHRpbmcoXG4gICAgICAgIGVtYWlsRW5hYmxlZCxcbiAgICAgICAgcGhvbmVFbmFibGVkLFxuICAgICAgICBwcm9wcy5hY2NvdW50UmVjb3ZlcnksXG4gICAgICApLFxuICAgICAgcmVtb3ZhbFBvbGljeTogUmVtb3ZhbFBvbGljeS5ERVNUUk9ZLFxuICAgICAgdXNlckludml0YXRpb246XG4gICAgICAgIHR5cGVvZiBwcm9wcy5sb2dpbldpdGguZW1haWwgIT09ICdib29sZWFuJ1xuICAgICAgICAgID8gdGhpcy5nZXRVc2VySW52aXRhdGlvblNldHRpbmdzKFxuICAgICAgICAgICAgICBwcm9wcy5sb2dpbldpdGguZW1haWw/LnVzZXJJbnZpdGF0aW9uLFxuICAgICAgICAgICAgKVxuICAgICAgICAgIDogdW5kZWZpbmVkLFxuICAgICAgY3VzdG9tU2VuZGVyS21zS2V5OiB0aGlzLmN1c3RvbVNlbmRlcktNU2tleSxcbiAgICAgIHVzZXJQb29sTmFtZTogcHJvcHMubmFtZSB8fCB1bmRlZmluZWQsXG4gICAgfTtcbiAgICByZXR1cm4gdXNlclBvb2xQcm9wcztcbiAgfTtcblxuICAvKipcbiAgICogU2FuaXRpemUgY3VzdG9tZXIgaW5wdXQgYW5kIHJldHVybiBDb2duaXRvIFVzZXIgcG9vbCBjb21wYXRpYmxlIFNtcyBjb25maWd1cmF0aW9uc1xuICAgKi9cbiAgcHJpdmF0ZSBnZXRTbXNDb25maWd1cmF0aW9uKFxuICAgIHByb3BzOiBVc2VyUG9vbFNuc09wdGlvbnMgfCBDdXN0b21TbXNTZW5kZXIgfCB1bmRlZmluZWQsXG4gICkge1xuICAgIGlmICghcHJvcHMgfHwgJ2hhbmRsZXInIGluIHByb3BzKSB7XG4gICAgICAvLyBFaXRoZXIgbm8gY29uZmlndXJhdGlvbiBvciBjdXN0b20gc2VuZGVyIGlzIGNvbmZpZ3VyZWRcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGlmIChcbiAgICAgIChwcm9wcy5zbnNDYWxsZXJBcm4gJiYgIXByb3BzLmV4dGVybmFsSWQpIHx8XG4gICAgICAoIXByb3BzLnNuc0NhbGxlckFybiAmJiBwcm9wcy5leHRlcm5hbElkKVxuICAgICkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnQm90aCBleHRlcm5hbElkIGFuZCBzbnNDYWxsZXJBcm4gYXJlIHJlcXVpcmVkIHdoZW4gcHJvdmlkaW5nIGEgY3VzdG9tIElBTSByb2xlLiBFbnN1cmUgdGhhdCB5b3VyIElBTSByb2xlIHRydXN0IHBvbGljeSBoYXZlIGFuIHN0czpFeHRlcm5hbElkIGNvbmRpdGlvbiBhbmQgaXMgZXF1YWwgdG8gdGhlIGV4dGVybmFsSWQgdmFsdWUnLFxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIGV4dGVybmFsSWQ6ICdleHRlcm5hbElkJyBpbiBwcm9wcyA/IHByb3BzLmV4dGVybmFsSWQgOiB1bmRlZmluZWQsXG4gICAgICBzbnNDYWxsZXJBcm46XG4gICAgICAgICdzbnNDYWxsZXJBcm4nIGluIHByb3BzICYmIHByb3BzLnNuc0NhbGxlckFyblxuICAgICAgICAgID8gUm9sZS5mcm9tUm9sZUFybihcbiAgICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgICAgYCR7dGhpcy5uYW1lfVNtc1NlbmRlclJvbGVgLFxuICAgICAgICAgICAgICBwcm9wcy5zbnNDYWxsZXJBcm4sXG4gICAgICAgICAgICApXG4gICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICBzbnNSZWdpb246IHByb3BzLnNuc1JlZ2lvbixcbiAgICAgIGVuYWJsZVNNU1JvbGU6ICEhcHJvcHMsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQYXJzZXMgdGhlIHVzZXIgaW52aXRhdGlvbiBzZXR0aW5ncyBhbmQgaW5zZXJ0cyBjb2Rlcy91c2VybmFtZXMgd2hlcmUgbmVjZXNzYXJ5LlxuICAgKiBAcGFyYW0gc2V0dGluZ3MgdGhlIGludml0YXRpb24gc2V0dGluZ3NcbiAgICogQHJldHVybnMgY29nbml0by5Vc2VySW52aXRhdGlvbkNvbmZpZyB8IHVuZGVmaW5lZFxuICAgKi9cbiAgcHJpdmF0ZSBnZXRVc2VySW52aXRhdGlvblNldHRpbmdzKFxuICAgIHNldHRpbmdzOiBFbWFpbExvZ2luU2V0dGluZ3NbJ3VzZXJJbnZpdGF0aW9uJ10sXG4gICk6IGNvZ25pdG8uVXNlckludml0YXRpb25Db25maWcgfCB1bmRlZmluZWQge1xuICAgIGlmICghc2V0dGluZ3MpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICBlbWFpbFN1YmplY3Q6IHNldHRpbmdzLmVtYWlsU3ViamVjdCxcbiAgICAgIGVtYWlsQm9keTogc2V0dGluZ3MuZW1haWxCb2R5XG4gICAgICAgID8gc2V0dGluZ3MuZW1haWxCb2R5KFxuICAgICAgICAgICAgKCkgPT4gSU5WSVRBVElPTl9QTEFDRUhPTERFUlMuVVNFUk5BTUUsXG4gICAgICAgICAgICAoKSA9PiBJTlZJVEFUSU9OX1BMQUNFSE9MREVSUy5DT0RFLFxuICAgICAgICAgIClcbiAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICBzbXNNZXNzYWdlOiBzZXR0aW5ncy5zbXNNZXNzYWdlXG4gICAgICAgID8gc2V0dGluZ3Muc21zTWVzc2FnZShcbiAgICAgICAgICAgICgpID0+IElOVklUQVRJT05fUExBQ0VIT0xERVJTLlVTRVJOQU1FLFxuICAgICAgICAgICAgKCkgPT4gSU5WSVRBVElPTl9QTEFDRUhPTERFUlMuQ09ERSxcbiAgICAgICAgICApXG4gICAgICAgIDogdW5kZWZpbmVkLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZ5IHRoZSBlbWFpbCBib2R5IGRlcGVuZGluZyBvbiBpZiAnQ09ERScgb3IgJ0xJTksnIHN0eWxlIGlzIHVzZWQuXG4gICAqIFRoaXMgZW5zdXJlcyB0aGF0IHRoZSB0ZW1wbGF0ZSBjb250YWlucyB0aGUgbmVjZXNzYXJ5IHBsYWNlaG9sZGVycyBmb3IgQ29nbml0byB0byBpbnNlcnQgdmVyaWZpY2F0aW9uIGNvZGVzIG9yIGxpbmtzLlxuICAgKiBAcGFyYW0gZW1haWxTZXR0aW5ncyB0aGUgcHJvdmlkZWQgZW1haWwgc2V0dGluZ3NcbiAgICogQHJldHVybnMgZW1haWxCb2R5XG4gICAqL1xuICBwcml2YXRlIHZlcmlmeUVtYWlsQm9keShcbiAgICBlbWFpbFNldHRpbmdzOiBFbWFpbExvZ2luU2V0dGluZ3MsXG4gICk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgbGV0IGVtYWlsQm9keTogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgIGlmIChcbiAgICAgIGVtYWlsU2V0dGluZ3MudmVyaWZpY2F0aW9uRW1haWxCb2R5ICYmXG4gICAgICBlbWFpbFNldHRpbmdzLnZlcmlmaWNhdGlvbkVtYWlsU3R5bGUgIT09ICdMSU5LJ1xuICAgICkge1xuICAgICAgZW1haWxCb2R5ID0gZW1haWxTZXR0aW5ncy52ZXJpZmljYXRpb25FbWFpbEJvZHkoXG4gICAgICAgICgpID0+IFZFUklGSUNBVElPTl9FTUFJTF9QTEFDRUhPTERFUlMuQ09ERSxcbiAgICAgICk7XG4gICAgICBpZiAoIWVtYWlsQm9keS5pbmNsdWRlcyhWRVJJRklDQVRJT05fRU1BSUxfUExBQ0VIT0xERVJTLkNPREUpKSB7XG4gICAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgIFwiSW52YWxpZCBlbWFpbCBzZXR0aW5ncy4gUHJvcGVydHkgJ3ZlcmlmaWNhdGlvbkVtYWlsQm9keScgbXVzdCB1dGlsaXplIHRoZSAnY29kZScgcGFyYW1ldGVyIGF0IGxlYXN0IG9uY2UgYXMgYSBwbGFjZWhvbGRlciBmb3IgdGhlIHZlcmlmaWNhdGlvbiBjb2RlLlwiLFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoXG4gICAgICBlbWFpbFNldHRpbmdzLnZlcmlmaWNhdGlvbkVtYWlsQm9keSAmJlxuICAgICAgZW1haWxTZXR0aW5ncy52ZXJpZmljYXRpb25FbWFpbFN0eWxlID09PSAnTElOSydcbiAgICApIHtcbiAgICAgIGxldCBsaW5rVGV4dDogc3RyaW5nID0gJyc7XG4gICAgICBlbWFpbEJvZHkgPSBlbWFpbFNldHRpbmdzLnZlcmlmaWNhdGlvbkVtYWlsQm9keSgodGV4dD86IHN0cmluZykgPT4ge1xuICAgICAgICBsaW5rVGV4dCA9IHRleHRcbiAgICAgICAgICA/IGB7IyMke3RleHR9IyN9YFxuICAgICAgICAgIDogVkVSSUZJQ0FUSU9OX0VNQUlMX1BMQUNFSE9MREVSUy5MSU5LO1xuICAgICAgICByZXR1cm4gbGlua1RleHQ7XG4gICAgICB9KTtcbiAgICAgIGlmIChsaW5rVGV4dCA9PT0gJycgfHwgIWVtYWlsQm9keS5pbmNsdWRlcyhsaW5rVGV4dCkpIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgXCJJbnZhbGlkIGVtYWlsIHNldHRpbmdzLiBQcm9wZXJ0eSAndmVyaWZpY2F0aW9uRW1haWxCb2R5JyBtdXN0IHV0aWxpemUgdGhlICdsaW5rJyBwYXJhbWV0ZXIgYXQgbGVhc3Qgb25jZSBhcyBhIHBsYWNlaG9sZGVyIGZvciB0aGUgdmVyaWZpY2F0aW9uIGxpbmsuXCIsXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBlbWFpbEJvZHk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGVtYWlsIHZlcmlmaWNhdGlvbiBzdHlsZSBmcm9tIHVzZXIgcHJvcHNcbiAgICogQHBhcmFtIHZlcmlmaWNhdGlvbkVtYWlsU3R5bGUgLSBzdHJpbmcgdmFsdWVcbiAgICogQHJldHVybnMgdmVyaWZpY2F0aW9uRW1haWxTdHlsZSAtIGVudW0gdmFsdWVcbiAgICovXG4gIHByaXZhdGUgZ2V0RW1haWxWZXJpZmljYXRpb25TdHlsZSA9IChcbiAgICB2ZXJpZmljYXRpb25FbWFpbFN0eWxlOiAnQ09ERScgfCAnTElOSycgfCB1bmRlZmluZWQsXG4gICk6IGNvZ25pdG8uVmVyaWZpY2F0aW9uRW1haWxTdHlsZSB8IHVuZGVmaW5lZCA9PiB7XG4gICAgaWYgKHZlcmlmaWNhdGlvbkVtYWlsU3R5bGUgPT09ICdDT0RFJykge1xuICAgICAgcmV0dXJuIGNvZ25pdG8uVmVyaWZpY2F0aW9uRW1haWxTdHlsZS5DT0RFO1xuICAgIH0gZWxzZSBpZiAodmVyaWZpY2F0aW9uRW1haWxTdHlsZSA9PT0gJ0xJTksnKSB7XG4gICAgICByZXR1cm4gY29nbml0by5WZXJpZmljYXRpb25FbWFpbFN0eWxlLkxJTks7XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH07XG5cbiAgLyoqXG4gICAqIERldGVybWluZSB0aGUgYWNjb3VudCByZWNvdmVyeSBvcHRpb24gYmFzZWQgb24gZW5hYmxlZCBsb2dpbiBtZXRob2RzLlxuICAgKiBAcGFyYW0gZW1haWxFbmFibGVkIC0gaXMgZW1haWwgZW5hYmxlZFxuICAgKiBAcGFyYW0gcGhvbmVFbmFibGVkIC0gaXMgcGhvbmUgZW5hYmxlZFxuICAgKiBAcGFyYW0gYWNjb3VudFJlY292ZXJ5TWV0aG9kQXNTdHJpbmcgLSB0aGUgdXNlciBwcm92aWRlZCBhY2NvdW50IHJlY292ZXJ5IHNldHRpbmdcbiAgICogQHJldHVybnMgYWNjb3VudCByZWNvdmVyeSBzZXR0aW5nIGVudW0gdmFsdWVcbiAgICovXG4gIHByaXZhdGUgZ2V0QWNjb3VudFJlY292ZXJ5U2V0dGluZyA9IChcbiAgICBlbWFpbEVuYWJsZWQ6IGJvb2xlYW4sXG4gICAgcGhvbmVFbmFibGVkOiBib29sZWFuLFxuICAgIGFjY291bnRSZWNvdmVyeU1ldGhvZEFzU3RyaW5nOiBBdXRoUHJvcHNbJ2FjY291bnRSZWNvdmVyeSddLFxuICApOiBjb2duaXRvLkFjY291bnRSZWNvdmVyeSB8IHVuZGVmaW5lZCA9PiB7XG4gICAgY29uc3QgYWNjb3VudFJlY292ZXJ5ID0gdGhpcy5jb252ZXJ0QWNjb3VudFJlY292ZXJ5U3RyaW5nVG9FbnVtKFxuICAgICAgYWNjb3VudFJlY292ZXJ5TWV0aG9kQXNTdHJpbmcsXG4gICAgKTtcbiAgICBpZiAoYWNjb3VudFJlY292ZXJ5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiBhY2NvdW50UmVjb3Zlcnk7XG4gICAgfVxuICAgIC8vIHNldCBkZWZhdWx0IGJhc2VkIG9uIGVuYWJsZWQgbG9naW4gbWV0aG9kc1xuICAgIGlmIChwaG9uZUVuYWJsZWQgJiYgZW1haWxFbmFibGVkKSB7XG4gICAgICByZXR1cm4gY29nbml0by5BY2NvdW50UmVjb3ZlcnkuRU1BSUxfT05MWTtcbiAgICB9XG4gICAgaWYgKHBob25lRW5hYmxlZCkge1xuICAgICAgcmV0dXJuIGNvZ25pdG8uQWNjb3VudFJlY292ZXJ5LlBIT05FX09OTFlfV0lUSE9VVF9NRkE7XG4gICAgfVxuICAgIGlmIChlbWFpbEVuYWJsZWQpIHtcbiAgICAgIHJldHVybiBjb2duaXRvLkFjY291bnRSZWNvdmVyeS5FTUFJTF9PTkxZO1xuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9O1xuXG4gIC8qKlxuICAgKiBDb252ZXJ0IHVzZXIgZnJpZW5kbHkgTWZhIG1vZGUgdG8gY29nbml0byBNZmEgTW9kZS5cbiAgICogVGhpcyBlbGltaW5hdGVzIHRoZSBuZWVkIGZvciB1c2VycyB0byBpbXBvcnQgY29nbml0by5NZmEuXG4gICAqIEBwYXJhbSBtZmEgLSBNRkEgc2V0dGluZ3NcbiAgICogQHJldHVybnMgY29nbml0byBNRkEgZW5mb3JjZW1lbnQgbW9kZVxuICAgKi9cbiAgcHJpdmF0ZSBnZXRNRkFNb2RlID0gKG1mYTogQXV0aFByb3BzWydtdWx0aWZhY3RvciddKTogTWZhIHwgdW5kZWZpbmVkID0+IHtcbiAgICBpZiAobWZhKSB7XG4gICAgICBzd2l0Y2ggKG1mYS5tb2RlKSB7XG4gICAgICAgIGNhc2UgJ09GRic6XG4gICAgICAgICAgcmV0dXJuIE1mYS5PRkY7XG4gICAgICAgIGNhc2UgJ09QVElPTkFMJzpcbiAgICAgICAgICByZXR1cm4gTWZhLk9QVElPTkFMO1xuICAgICAgICBjYXNlICdSRVFVSVJFRCc6XG4gICAgICAgICAgcmV0dXJuIE1mYS5SRVFVSVJFRDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfTtcblxuICAvKipcbiAgICogQ29udmVydCB1c2VyIGZyaWVuZGx5IE1mYSB0eXBlIHRvIGNvZ25pdG8gTWZhIHR5cGUuXG4gICAqIFRoaXMgZWxpbWluYXRlcyB0aGUgbmVlZCBmb3IgdXNlcnMgdG8gaW1wb3J0IGNvZ25pdG8uTWZhLlxuICAgKiBAcGFyYW0gbWZhIC0gTUZBIHNldHRpbmdzXG4gICAqIEByZXR1cm5zIGNvZ25pdG8gTUZBIHR5cGUgKHNtcywgdG90cCwgb3IgZW1haWwpXG4gICAqL1xuICBwcml2YXRlIGdldE1GQVR5cGUgPSAoXG4gICAgbWZhOiBBdXRoUHJvcHNbJ211bHRpZmFjdG9yJ10sXG4gICk6IE1mYVNlY29uZEZhY3RvciB8IHVuZGVmaW5lZCA9PiB7XG4gICAgcmV0dXJuIHR5cGVvZiBtZmEgPT09ICdvYmplY3QnICYmIG1mYS5tb2RlICE9PSAnT0ZGJ1xuICAgICAgPyB7XG4gICAgICAgICAgc21zOiBtZmEuc21zID8gdHJ1ZSA6IGZhbHNlLFxuICAgICAgICAgIG90cDogbWZhLnRvdHAgPyB0cnVlIDogZmFsc2UsXG4gICAgICAgICAgZW1haWw6IG1mYS5lbWFpbCA/IHRydWUgOiBmYWxzZSxcbiAgICAgICAgfVxuICAgICAgOiB1bmRlZmluZWQ7XG4gIH07XG5cbiAgLyoqXG4gICAqIENvbnZlcnQgdXNlciBmcmllbmRseSBhY2NvdW50IHJlY292ZXJ5IG1ldGhvZCB0byBjb2duaXRvIEFjY291bnRSZWNvdmVyIGVudW0uXG4gICAqIFRoaXMgZWxpbWluYXRlcyB0aGUgbmVlZCBmb3IgdXNlcnMgdG8gaW1wb3J0IGNvZ25pdG8uQWNjb3VudFJlY292ZXJ5LlxuICAgKiBAcGFyYW0gbWV0aG9kIC0gYWNjb3VudCByZWNvdmVyeSBtZXRob2QgYXMgYSBzdHJpbmcgdmFsdWVcbiAgICogQHJldHVybnMgY29nbml0by5BY2NvdW50UmVjb3ZlcnkgZW51bSB2YWx1ZVxuICAgKi9cbiAgcHJpdmF0ZSBjb252ZXJ0QWNjb3VudFJlY292ZXJ5U3RyaW5nVG9FbnVtID0gKFxuICAgIG1ldGhvZDogQXV0aFByb3BzWydhY2NvdW50UmVjb3ZlcnknXSxcbiAgKTogY29nbml0by5BY2NvdW50UmVjb3ZlcnkgfCB1bmRlZmluZWQgPT4ge1xuICAgIGlmIChtZXRob2QgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIGNvZ25pdG8uQWNjb3VudFJlY292ZXJ5W21ldGhvZF07XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH07XG5cbiAgLyoqXG4gICAqIEV4dHJhY3QgdGhlIE1GQSBtZXNzYWdlIHNldHRpbmdzIGFuZCBwZXJmb3JtIHZhbGlkYXRpb24uXG4gICAqIEBwYXJhbSBtZmEgLSBNRkEgc2V0dGluZ3NcbiAgICogQHJldHVybnMgbWZhIG1lc3NhZ2VcbiAgICovXG4gIHByaXZhdGUgZ2V0TUZBTWVzc2FnZSA9IChcbiAgICBtZmE6IEF1dGhQcm9wc1snbXVsdGlmYWN0b3InXSxcbiAgKTogc3RyaW5nIHwgdW5kZWZpbmVkID0+IHtcbiAgICBpZiAobWZhICYmIG1mYS5tb2RlICE9PSAnT0ZGJyAmJiB0eXBlb2YgbWZhLnNtcyA9PT0gJ29iamVjdCcpIHtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBtZmEuc21zLnNtc01lc3NhZ2UoKCkgPT4gTUZBX1NNU19QTEFDRUhPTERFUlMuQ09ERSk7XG4gICAgICBpZiAoIW1lc3NhZ2UuaW5jbHVkZXMoTUZBX1NNU19QTEFDRUhPTERFUlMuQ09ERSkpIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgXCJJbnZhbGlkIE1GQSBzZXR0aW5ncy4gUHJvcGVydHkgJ3Ntc01lc3NhZ2UnIG11c3QgdXRpbGl6ZSB0aGUgJ2NvZGUnIHBhcmFtZXRlciBhdCBsZWFzdCBvbmNlIGFzIGEgcGxhY2Vob2xkZXIgZm9yIHRoZSB2ZXJpZmljYXRpb24gY29kZS5cIixcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9O1xuXG4gIC8qKlxuICAgKiBTZXR1cCBFeHRlcm5hbCBQcm92aWRlcnMgKE9BdXRoL09JREMvU0FNTCkgYW5kIHJlbGF0ZWQgc2V0dGluZ3NcbiAgICogc3VjaCBhcyBPQXV0aCBzZXR0aW5ncyBhbmQgVXNlciBQb29sIERvbWFpbnNcbiAgICovXG4gIHByaXZhdGUgc2V0dXBFeHRlcm5hbFByb3ZpZGVycyA9IChcbiAgICB1c2VyUG9vbDogVXNlclBvb2wsXG4gICAgbG9naW5PcHRpb25zOiBBdXRoUHJvcHNbJ2xvZ2luV2l0aCddLFxuICApOiBJZGVudGl0eVByb3ZpZGVyU2V0dXBSZXN1bHQgPT4ge1xuICAgIC8qKlxuICAgICAqIElmIGVtYWlsIGlzIGVuYWJsZWQsIGFuZCBpcyB0aGUgb25seSByZXF1aXJlZCBhdHRyaWJ1dGUsIHdlIGFyZSBhYmxlIHRvXG4gICAgICogYXV0b21hdGljYWxseSBtYXAgdGhlIGVtYWlsIGF0dHJpYnV0ZSBmcm9tIGV4dGVybmFsIHByb3ZpZGVycywgZXhjbHVkaW5nIFNBTUwuXG4gICAgICovXG4gICAgY29uc3Qgc2hvdWxkTWFwRW1haWxBdHRyaWJ1dGVzID0gbG9naW5PcHRpb25zLmVtYWlsICYmICFsb2dpbk9wdGlvbnMucGhvbmU7XG4gICAgY29uc3QgcmVzdWx0OiBJZGVudGl0eVByb3ZpZGVyU2V0dXBSZXN1bHQgPSB7XG4gICAgICBvQXV0aE1hcHBpbmdzOiB7fSxcbiAgICAgIG9BdXRoU2V0dGluZ3M6IHtcbiAgICAgICAgZmxvd3M6IERFRkFVTFRTLk9BVVRIX0ZMT1dTLFxuICAgICAgfSxcbiAgICB9O1xuICAgIC8vIGV4dGVybmFsIHByb3ZpZGVyc1xuICAgIGNvbnN0IGV4dGVybmFsID0gbG9naW5PcHRpb25zLmV4dGVybmFsUHJvdmlkZXJzO1xuICAgIGlmICghZXh0ZXJuYWwpIHtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIC8vIG1ha2Ugc3VyZSBsb2dvdXQvY2FsbGJhY2sgdXJscyBhcmUgbm90IGVtcHR5XG4gICAgaWYgKGV4dGVybmFsLmxvZ291dFVybHMgJiYgZXh0ZXJuYWwubG9nb3V0VXJscy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAnWW91IG11c3QgZGVmaW5lIGxvZ291dFVybHMgd2hlbiBjb25maWd1cmluZyBleHRlcm5hbCBsb2dpbiBwcm92aWRlcnMuJyxcbiAgICAgICk7XG4gICAgfVxuICAgIGlmIChleHRlcm5hbC5jYWxsYmFja1VybHMgJiYgZXh0ZXJuYWwuY2FsbGJhY2tVcmxzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICdZb3UgbXVzdCBkZWZpbmUgY2FsbGJhY2tVcmxzIHdoZW4gY29uZmlndXJpbmcgZXh0ZXJuYWwgbG9naW4gcHJvdmlkZXJzLicsXG4gICAgICApO1xuICAgIH1cbiAgICBpZiAoZXh0ZXJuYWwuZ29vZ2xlKSB7XG4gICAgICBjb25zdCBnb29nbGVQcm9wcyA9IGV4dGVybmFsLmdvb2dsZTtcbiAgICAgIHJlc3VsdC5nb29nbGUgPSBuZXcgY29nbml0by5Vc2VyUG9vbElkZW50aXR5UHJvdmlkZXJHb29nbGUoXG4gICAgICAgIHRoaXMsXG4gICAgICAgIGAke3RoaXMubmFtZX1Hb29nbGVJZFBgLFxuICAgICAgICB7XG4gICAgICAgICAgdXNlclBvb2wsXG4gICAgICAgICAgY2xpZW50SWQ6IGdvb2dsZVByb3BzLmNsaWVudElkLFxuICAgICAgICAgIGNsaWVudFNlY3JldFZhbHVlOiBnb29nbGVQcm9wcy5jbGllbnRTZWNyZXQsXG4gICAgICAgICAgYXR0cmlidXRlTWFwcGluZzoge1xuICAgICAgICAgICAgLi4uKHNob3VsZE1hcEVtYWlsQXR0cmlidXRlc1xuICAgICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICAgIGVtYWlsOiBQcm92aWRlckF0dHJpYnV0ZS5HT09HTEVfRU1BSUwsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICA6IHVuZGVmaW5lZCksXG4gICAgICAgICAgICAuLi50aGlzLmNvbnZlcnRUb0NvZ25pdG9BdHRyaWJ1dGVNYXBwaW5nKFxuICAgICAgICAgICAgICBnb29nbGVQcm9wcy5hdHRyaWJ1dGVNYXBwaW5nLFxuICAgICAgICAgICAgKSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNjb3BlczogZ29vZ2xlUHJvcHMuc2NvcGVzLFxuICAgICAgICB9LFxuICAgICAgKTtcbiAgICAgIHJlc3VsdC5vQXV0aE1hcHBpbmdzW29hdXRoUHJvdmlkZXJUb1Byb3ZpZGVyRG9tYWluTWFwLmdvb2dsZV0gPVxuICAgICAgICBleHRlcm5hbC5nb29nbGUuY2xpZW50SWQ7XG4gICAgfVxuICAgIGlmIChleHRlcm5hbC5mYWNlYm9vaykge1xuICAgICAgcmVzdWx0LmZhY2Vib29rID0gbmV3IGNvZ25pdG8uVXNlclBvb2xJZGVudGl0eVByb3ZpZGVyRmFjZWJvb2soXG4gICAgICAgIHRoaXMsXG4gICAgICAgIGAke3RoaXMubmFtZX1GYWNlYm9va0lEUGAsXG4gICAgICAgIHtcbiAgICAgICAgICB1c2VyUG9vbCxcbiAgICAgICAgICAuLi5leHRlcm5hbC5mYWNlYm9vayxcbiAgICAgICAgICBhdHRyaWJ1dGVNYXBwaW5nOiB7XG4gICAgICAgICAgICAuLi4oc2hvdWxkTWFwRW1haWxBdHRyaWJ1dGVzXG4gICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgZW1haWw6IFByb3ZpZGVyQXR0cmlidXRlLkZBQ0VCT09LX0VNQUlMLFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgOiB1bmRlZmluZWQpLFxuICAgICAgICAgICAgLi4udGhpcy5jb252ZXJ0VG9Db2duaXRvQXR0cmlidXRlTWFwcGluZyhcbiAgICAgICAgICAgICAgZXh0ZXJuYWwuZmFjZWJvb2suYXR0cmlidXRlTWFwcGluZyxcbiAgICAgICAgICAgICksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgICByZXN1bHQub0F1dGhNYXBwaW5nc1tvYXV0aFByb3ZpZGVyVG9Qcm92aWRlckRvbWFpbk1hcC5mYWNlYm9va10gPVxuICAgICAgICBleHRlcm5hbC5mYWNlYm9vay5jbGllbnRJZDtcbiAgICB9XG4gICAgaWYgKGV4dGVybmFsLmxvZ2luV2l0aEFtYXpvbikge1xuICAgICAgcmVzdWx0LmFtYXpvbiA9IG5ldyBjb2duaXRvLlVzZXJQb29sSWRlbnRpdHlQcm92aWRlckFtYXpvbihcbiAgICAgICAgdGhpcyxcbiAgICAgICAgYCR7dGhpcy5uYW1lfUFtYXpvbklEUGAsXG4gICAgICAgIHtcbiAgICAgICAgICB1c2VyUG9vbCxcbiAgICAgICAgICAuLi5leHRlcm5hbC5sb2dpbldpdGhBbWF6b24sXG4gICAgICAgICAgYXR0cmlidXRlTWFwcGluZzoge1xuICAgICAgICAgICAgLi4uKHNob3VsZE1hcEVtYWlsQXR0cmlidXRlc1xuICAgICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICAgIGVtYWlsOiBQcm92aWRlckF0dHJpYnV0ZS5BTUFaT05fRU1BSUwsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICA6IHVuZGVmaW5lZCksXG4gICAgICAgICAgICAuLi50aGlzLmNvbnZlcnRUb0NvZ25pdG9BdHRyaWJ1dGVNYXBwaW5nKFxuICAgICAgICAgICAgICBleHRlcm5hbC5sb2dpbldpdGhBbWF6b24uYXR0cmlidXRlTWFwcGluZyxcbiAgICAgICAgICAgICksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgICByZXN1bHQub0F1dGhNYXBwaW5nc1tvYXV0aFByb3ZpZGVyVG9Qcm92aWRlckRvbWFpbk1hcC5hbWF6b25dID1cbiAgICAgICAgZXh0ZXJuYWwubG9naW5XaXRoQW1hem9uLmNsaWVudElkO1xuICAgIH1cbiAgICBpZiAoZXh0ZXJuYWwuc2lnbkluV2l0aEFwcGxlKSB7XG4gICAgICByZXN1bHQuYXBwbGUgPSBuZXcgY29nbml0by5Vc2VyUG9vbElkZW50aXR5UHJvdmlkZXJBcHBsZShcbiAgICAgICAgdGhpcyxcbiAgICAgICAgYCR7dGhpcy5uYW1lfUFwcGxlSURQYCxcbiAgICAgICAge1xuICAgICAgICAgIHVzZXJQb29sLFxuICAgICAgICAgIC4uLmV4dGVybmFsLnNpZ25JbldpdGhBcHBsZSxcbiAgICAgICAgICBhdHRyaWJ1dGVNYXBwaW5nOiB7XG4gICAgICAgICAgICAuLi4oc2hvdWxkTWFwRW1haWxBdHRyaWJ1dGVzXG4gICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgZW1haWw6IFByb3ZpZGVyQXR0cmlidXRlLkFQUExFX0VNQUlMLFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgOiB1bmRlZmluZWQpLFxuICAgICAgICAgICAgLi4udGhpcy5jb252ZXJ0VG9Db2duaXRvQXR0cmlidXRlTWFwcGluZyhcbiAgICAgICAgICAgICAgZXh0ZXJuYWwuc2lnbkluV2l0aEFwcGxlLmF0dHJpYnV0ZU1hcHBpbmcsXG4gICAgICAgICAgICApLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICApO1xuICAgICAgcmVzdWx0Lm9BdXRoTWFwcGluZ3Nbb2F1dGhQcm92aWRlclRvUHJvdmlkZXJEb21haW5NYXAuYXBwbGVdID1cbiAgICAgICAgZXh0ZXJuYWwuc2lnbkluV2l0aEFwcGxlLmNsaWVudElkO1xuICAgIH1cbiAgICBpZiAoZXh0ZXJuYWwub2lkYyAmJiBleHRlcm5hbC5vaWRjLmxlbmd0aCA+IDApIHtcbiAgICAgIHJlc3VsdC5vaWRjID0gW107XG4gICAgICBleHRlcm5hbC5vaWRjLmZvckVhY2goKHByb3ZpZGVyLCBpbmRleCkgPT4ge1xuICAgICAgICBjb25zdCByZXF1ZXN0TWV0aG9kID1cbiAgICAgICAgICBwcm92aWRlci5hdHRyaWJ1dGVSZXF1ZXN0TWV0aG9kID09PSB1bmRlZmluZWRcbiAgICAgICAgICAgID8gJ0dFVCcgLy8gZGVmYXVsdCBpZiBub3QgZGVmaW5lZFxuICAgICAgICAgICAgOiBwcm92aWRlci5hdHRyaWJ1dGVSZXF1ZXN0TWV0aG9kO1xuICAgICAgICBjb25zdCBnZW5lcmF0ZWRQcm92aWRlciA9IG5ldyBjb2duaXRvLlVzZXJQb29sSWRlbnRpdHlQcm92aWRlck9pZGMoXG4gICAgICAgICAgdGhpcyxcbiAgICAgICAgICBgJHt0aGlzLm5hbWV9JHtwcm92aWRlci5uYW1lID8/IGluZGV4fU9pZGNJRFBgLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHVzZXJQb29sLFxuICAgICAgICAgICAgYXR0cmlidXRlUmVxdWVzdE1ldGhvZDpcbiAgICAgICAgICAgICAgcmVxdWVzdE1ldGhvZCA9PT0gJ0dFVCdcbiAgICAgICAgICAgICAgICA/IE9pZGNBdHRyaWJ1dGVSZXF1ZXN0TWV0aG9kLkdFVFxuICAgICAgICAgICAgICAgIDogT2lkY0F0dHJpYnV0ZVJlcXVlc3RNZXRob2QuUE9TVCxcbiAgICAgICAgICAgIGNsaWVudElkOiBwcm92aWRlci5jbGllbnRJZCxcbiAgICAgICAgICAgIGNsaWVudFNlY3JldDogcHJvdmlkZXIuY2xpZW50U2VjcmV0LFxuICAgICAgICAgICAgZW5kcG9pbnRzOiBwcm92aWRlci5lbmRwb2ludHMsXG4gICAgICAgICAgICBpZGVudGlmaWVyczogcHJvdmlkZXIuaWRlbnRpZmllcnMsXG4gICAgICAgICAgICBpc3N1ZXJVcmw6IHByb3ZpZGVyLmlzc3VlclVybCxcbiAgICAgICAgICAgIG5hbWU6IHByb3ZpZGVyLm5hbWUsXG4gICAgICAgICAgICBzY29wZXM6IHByb3ZpZGVyLnNjb3BlcyxcbiAgICAgICAgICAgIGF0dHJpYnV0ZU1hcHBpbmc6IHtcbiAgICAgICAgICAgICAgLi4uKHNob3VsZE1hcEVtYWlsQXR0cmlidXRlc1xuICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICBlbWFpbDoge1xuICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdlbWFpbCcsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgOiB1bmRlZmluZWQpLFxuICAgICAgICAgICAgICAuLi50aGlzLmNvbnZlcnRUb0NvZ25pdG9BdHRyaWJ1dGVNYXBwaW5nKFxuICAgICAgICAgICAgICAgIHByb3ZpZGVyLmF0dHJpYnV0ZU1hcHBpbmcsXG4gICAgICAgICAgICAgICksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICk7XG4gICAgICAgIHJlc3VsdC5vaWRjPy5wdXNoKGdlbmVyYXRlZFByb3ZpZGVyKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoZXh0ZXJuYWwuc2FtbCkge1xuICAgICAgY29uc3Qgc2FtbCA9IGV4dGVybmFsLnNhbWw7XG4gICAgICByZXN1bHQuc2FtbCA9IG5ldyBjb2duaXRvLlVzZXJQb29sSWRlbnRpdHlQcm92aWRlclNhbWwoXG4gICAgICAgIHRoaXMsXG4gICAgICAgIGAke3RoaXMubmFtZX1TYW1sSURQYCxcbiAgICAgICAge1xuICAgICAgICAgIHVzZXJQb29sLFxuICAgICAgICAgIGF0dHJpYnV0ZU1hcHBpbmc6IHRoaXMuY29udmVydFRvQ29nbml0b0F0dHJpYnV0ZU1hcHBpbmcoXG4gICAgICAgICAgICBzYW1sLmF0dHJpYnV0ZU1hcHBpbmcsXG4gICAgICAgICAgKSxcbiAgICAgICAgICBpZGVudGlmaWVyczogc2FtbC5pZGVudGlmaWVycyxcbiAgICAgICAgICBpZHBTaWdub3V0OiBzYW1sLmlkcFNpZ25vdXQsXG4gICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgIG1ldGFkYXRhQ29udGVudDogc2FtbC5tZXRhZGF0YS5tZXRhZGF0YUNvbnRlbnQsXG4gICAgICAgICAgICBtZXRhZGF0YVR5cGU6XG4gICAgICAgICAgICAgIHNhbWwubWV0YWRhdGEubWV0YWRhdGFUeXBlID09PSAnRklMRSdcbiAgICAgICAgICAgICAgICA/IFVzZXJQb29sSWRlbnRpdHlQcm92aWRlclNhbWxNZXRhZGF0YVR5cGUuRklMRVxuICAgICAgICAgICAgICAgIDogVXNlclBvb2xJZGVudGl0eVByb3ZpZGVyU2FtbE1ldGFkYXRhVHlwZS5VUkwsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBuYW1lOiBzYW1sLm5hbWUsXG4gICAgICAgIH0sXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEFsd2F5cyBnZW5lcmF0ZSBhIGRvbWFpbiBwcmVmaXggaWYgZXh0ZXJuYWwgcHJvdmlkZXIgaXMgY29uZmlndXJlZFxuICAgIGlmICh0aGlzLmRvbWFpblByZWZpeCkge1xuICAgICAgdGhpcy51c2VyUG9vbC5hZGREb21haW4oYCR7dGhpcy5uYW1lfVVzZXJQb29sRG9tYWluYCwge1xuICAgICAgICBjb2duaXRvRG9tYWluOiB7IGRvbWFpblByZWZpeDogdGhpcy5kb21haW5QcmVmaXggfSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdDb2duaXRvIERvbWFpbiBQcmVmaXggaXMgbWlzc2luZyB3aGVuIGV4dGVybmFsIHByb3ZpZGVycyBhcmUgY29uZmlndXJlZC4nLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBvYXV0aCBzZXR0aW5ncyBmb3IgdGhlIFVzZXJQb29sIGNsaWVudFxuICAgIHJlc3VsdC5vQXV0aFNldHRpbmdzID0ge1xuICAgICAgY2FsbGJhY2tVcmxzOiBleHRlcm5hbC5jYWxsYmFja1VybHMsXG4gICAgICBsb2dvdXRVcmxzOiBleHRlcm5hbC5sb2dvdXRVcmxzLFxuICAgICAgc2NvcGVzOiBleHRlcm5hbC5zY29wZXNcbiAgICAgICAgPyB0aGlzLmdldE9BdXRoU2NvcGVzKGV4dGVybmFsLnNjb3BlcylcbiAgICAgICAgOiBERUZBVUxUX09BVVRIX1NDT1BFUyxcbiAgICAgIGZsb3dzOiBERUZBVUxUUy5PQVVUSF9GTE9XUyxcbiAgICB9O1xuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICAvKipcbiAgICogQ29udmVydHMgdGhlIHNpbXBsaWZpZWQgbWFwcGluZyB0eXBlIHRvIGNvZ25pdG8uQXR0cmlidXRlTWFwcGluZy5cbiAgICogQHBhcmFtIG1hcHBpbmcgdGhlIEF0dHJpYnV0ZU1hcHBpbmcgdG8gY29udmVydCB0byBhIGNvZ25pdG8uQXR0cmlidXRlTWFwcGluZ1xuICAgKiBAcmV0dXJucyBjb2duaXRvLkF0dHJpYnV0ZU1hcHBpbmdcbiAgICovXG4gIHByaXZhdGUgY29udmVydFRvQ29nbml0b0F0dHJpYnV0ZU1hcHBpbmcgPSAoXG4gICAgbWFwcGluZz86IEF0dHJpYnV0ZU1hcHBpbmcsXG4gICk6IGNvZ25pdG8uQXR0cmlidXRlTWFwcGluZyB8IHVuZGVmaW5lZCA9PiB7XG4gICAgaWYgKCFtYXBwaW5nKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBjb25zdCByZXN1bHQ6IFJlY29yZDxcbiAgICAgIHN0cmluZyxcbiAgICAgIHwgUHJvdmlkZXJBdHRyaWJ1dGVcbiAgICAgIHwge1xuICAgICAgICAgIFtrZXk6IHN0cmluZ106IFByb3ZpZGVyQXR0cmlidXRlO1xuICAgICAgICB9XG4gICAgPiA9IHt9O1xuICAgIGZvciAoY29uc3QgW2F0dHJOYW1lLCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMobWFwcGluZykpIHtcbiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHJlc3VsdFthdHRyTmFtZV0gPSB7XG4gICAgICAgICAgYXR0cmlidXRlTmFtZTogdmFsdWUsXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiBhdHRyTmFtZSA9PT0gJ2N1c3RvbScpIHtcbiAgICAgICAgLy8gZGVhbGluZyB3aXRoIGN1c3RvbSBhdHRyaWJ1dGVzXG4gICAgICAgIGNvbnN0IGN1c3RvbUF0dHJpYnV0ZXM6IFJlY29yZDxzdHJpbmcsIFByb3ZpZGVyQXR0cmlidXRlPiA9IHt9O1xuICAgICAgICBmb3IgKGNvbnN0IFtjdXN0b21LZXksIGF0dHJOYW1lXSBvZiBPYmplY3QuZW50cmllcyh2YWx1ZSkpIHtcbiAgICAgICAgICBjdXN0b21BdHRyaWJ1dGVzW2N1c3RvbUtleV0gPSB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiBhdHRyTmFtZSxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdFthdHRyTmFtZV0gPSBjdXN0b21BdHRyaWJ1dGVzO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuICAvKipcbiAgICogQ29udmVydCBzY29wZXMgZnJvbSBzdHJpbmcgbGlzdCB0byBPQXV0aFNjb3Blcy5cbiAgICogQHBhcmFtIHNjb3BlcyAtIHNjb3BlIGxpc3RcbiAgICogQHJldHVybnMgY29nbml0byBPQXV0aFNjb3Blc1xuICAgKi9cbiAgcHJpdmF0ZSBnZXRPQXV0aFNjb3BlcyA9IChcbiAgICBzY29wZXM6IEV4dGVybmFsUHJvdmlkZXJPcHRpb25zWydzY29wZXMnXSxcbiAgKTogY29nbml0by5PQXV0aFNjb3BlW10gPT4ge1xuICAgIGlmIChzY29wZXMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICBjb25zdCByZXN1bHQ6IGNvZ25pdG8uT0F1dGhTY29wZVtdID0gW107XG4gICAgZm9yIChjb25zdCBzY29wZSBvZiBzY29wZXMpIHtcbiAgICAgIHJlc3VsdC5wdXNoKGNvZ25pdG8uT0F1dGhTY29wZVtzY29wZV0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIC8qKlxuICAgKiBTdG9yZXMgYXV0aCBvdXRwdXQgdXNpbmcgdGhlIHByb3ZpZGVkIHN0cmF0ZWd5XG4gICAqL1xuICBwcml2YXRlIHN0b3JlT3V0cHV0ID0gKFxuICAgIG91dHB1dFN0b3JhZ2VTdHJhdGVneTogQmFja2VuZE91dHB1dFN0b3JhZ2VTdHJhdGVneTxBdXRoT3V0cHV0PiA9IG5ldyBTdGFja01ldGFkYXRhQmFja2VuZE91dHB1dFN0b3JhZ2VTdHJhdGVneShcbiAgICAgIFN0YWNrLm9mKHRoaXMpLFxuICAgICksXG4gICk6IHZvaWQgPT4ge1xuICAgIGNvbnN0IGNmblVzZXJQb29sID0gdGhpcy5yZXNvdXJjZXMuY2ZuUmVzb3VyY2VzLmNmblVzZXJQb29sO1xuICAgIGNvbnN0IGNmblVzZXJQb29sQ2xpZW50ID0gdGhpcy5yZXNvdXJjZXMuY2ZuUmVzb3VyY2VzLmNmblVzZXJQb29sQ2xpZW50O1xuICAgIGNvbnN0IGNmbklkZW50aXR5UG9vbCA9IHRoaXMucmVzb3VyY2VzLmNmblJlc291cmNlcy5jZm5JZGVudGl0eVBvb2w7XG4gICAgLy8gdGhlc2UgcHJvcGVydGllcyBjYW5ub3QgYmUgb3ZlcndyaXR0ZW5cbiAgICBjb25zdCBvdXRwdXQ6IEF1dGhPdXRwdXRbJ3BheWxvYWQnXSA9IHtcbiAgICAgIHVzZXJQb29sSWQ6IHRoaXMucmVzb3VyY2VzLnVzZXJQb29sLnVzZXJQb29sSWQsXG4gICAgICB3ZWJDbGllbnRJZDogdGhpcy5yZXNvdXJjZXMudXNlclBvb2xDbGllbnQudXNlclBvb2xDbGllbnRJZCxcbiAgICAgIGlkZW50aXR5UG9vbElkOiBjZm5JZGVudGl0eVBvb2wucmVmLFxuICAgICAgYXV0aFJlZ2lvbjogU3RhY2sub2YodGhpcykucmVnaW9uLFxuICAgIH07XG5cbiAgICAvLyB0aGUgcHJvcGVydGllcyBiZWxvdyB0aGlzIGxpbmUgY2FuIGJlIG92ZXJ3cml0dGVuLCBzbyB0aGV5IGFyZSBleHBvc2VkIHZpYSBjZGsgTEFaWVxuICAgIG91dHB1dC5hbGxvd1VuYXV0aGVudGljYXRlZElkZW50aXRpZXMgPSBMYXp5LnN0cmluZyh7XG4gICAgICBwcm9kdWNlOiAoKSA9PlxuICAgICAgICBjZm5JZGVudGl0eVBvb2wuYWxsb3dVbmF1dGhlbnRpY2F0ZWRJZGVudGl0aWVzID09PSB0cnVlXG4gICAgICAgICAgPyAndHJ1ZSdcbiAgICAgICAgICA6ICdmYWxzZScsXG4gICAgfSk7XG5cbiAgICAvLyBleHRyYWN0IHNpZ251cEF0dHJpYnV0ZXMgZnJvbSBVc2VyUG9vbCBzY2hlbWEncyByZXF1aXJlZCBhdHRyaWJ1dGVzXG4gICAgb3V0cHV0LnNpZ251cEF0dHJpYnV0ZXMgPSBMYXp5LnN0cmluZyh7XG4gICAgICBwcm9kdWNlOiAoKSA9PiB7XG4gICAgICAgIGlmICghY2ZuVXNlclBvb2wuc2NoZW1hKSB7XG4gICAgICAgICAgcmV0dXJuICdbXSc7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KFxuICAgICAgICAgIChjZm5Vc2VyUG9vbC5zY2hlbWEgYXMgQ2ZuVXNlclBvb2wuU2NoZW1hQXR0cmlidXRlUHJvcGVydHlbXSlcbiAgICAgICAgICAgIC5maWx0ZXIoKGF0dHJpYnV0ZSkgPT4gYXR0cmlidXRlLnJlcXVpcmVkICYmIGF0dHJpYnV0ZS5uYW1lKVxuICAgICAgICAgICAgLm1hcCgoYXR0cmlidXRlKSA9PiBhdHRyaWJ1dGUubmFtZT8udG9Mb3dlckNhc2UoKSksXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gZXh0cmFjdCB1c2VybmFtZUF0dHJpYnV0ZXMgZnJvbSBVc2VyUG9vbCdzIHVzZXJuYW1lQXR0cmlidXRlc1xuICAgIG91dHB1dC51c2VybmFtZUF0dHJpYnV0ZXMgPSBMYXp5LnN0cmluZyh7XG4gICAgICBwcm9kdWNlOiAoKSA9PiB7XG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShcbiAgICAgICAgICBjZm5Vc2VyUG9vbC51c2VybmFtZUF0dHJpYnV0ZXM/Lm1hcCgoYXR0cikgPT4gYXR0ci50b0xvd2VyQ2FzZSgpKSB8fFxuICAgICAgICAgICAgW10sXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gZXh0cmFjdCB2ZXJpZmljYXRpb25NZWNoYW5pc21zIGZyb20gVXNlclBvb2wncyBhdXRvVmVyaWZpZWRBdHRyaWJ1dGVzXG4gICAgb3V0cHV0LnZlcmlmaWNhdGlvbk1lY2hhbmlzbXMgPSBMYXp5LnN0cmluZyh7XG4gICAgICBwcm9kdWNlOiAoKSA9PiB7XG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShjZm5Vc2VyUG9vbC5hdXRvVmVyaWZpZWRBdHRyaWJ1dGVzID8/IFtdKTtcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICAvLyBleHRyYWN0IHRoZSBwYXNzd29yZFBvbGljeSBmcm9tIHRoZSBVc2VyUG9vbCBwb2xpY2llc1xuICAgIG91dHB1dC5wYXNzd29yZFBvbGljeU1pbkxlbmd0aCA9IExhenkuc3RyaW5nKHtcbiAgICAgIHByb2R1Y2U6ICgpID0+IHtcbiAgICAgICAgaWYgKCFjZm5Vc2VyUG9vbC5wb2xpY2llcykge1xuICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwb2xpY3kgPSAoY2ZuVXNlclBvb2wucG9saWNpZXMgYXMgQ2ZuVXNlclBvb2wuUG9saWNpZXNQcm9wZXJ0eSlcbiAgICAgICAgICAucGFzc3dvcmRQb2xpY3kgYXMgQ2ZuVXNlclBvb2wuUGFzc3dvcmRQb2xpY3lQcm9wZXJ0eTtcbiAgICAgICAgcmV0dXJuIHBvbGljeS5taW5pbXVtTGVuZ3RoPy50b1N0cmluZygpO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIG91dHB1dC5wYXNzd29yZFBvbGljeVJlcXVpcmVtZW50cyA9IExhenkuc3RyaW5nKHtcbiAgICAgIHByb2R1Y2U6ICgpID0+IHtcbiAgICAgICAgaWYgKCFjZm5Vc2VyUG9vbC5wb2xpY2llcykge1xuICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwb2xpY3kgPSAoY2ZuVXNlclBvb2wucG9saWNpZXMgYXMgQ2ZuVXNlclBvb2wuUG9saWNpZXNQcm9wZXJ0eSlcbiAgICAgICAgICAucGFzc3dvcmRQb2xpY3kgYXMgQ2ZuVXNlclBvb2wuUGFzc3dvcmRQb2xpY3lQcm9wZXJ0eTtcbiAgICAgICAgY29uc3QgcmVxdWlyZW1lbnRzID0gW107XG4gICAgICAgIHBvbGljeS5yZXF1aXJlTnVtYmVycyAmJiByZXF1aXJlbWVudHMucHVzaCgnUkVRVUlSRVNfTlVNQkVSUycpO1xuICAgICAgICBwb2xpY3kucmVxdWlyZUxvd2VyY2FzZSAmJiByZXF1aXJlbWVudHMucHVzaCgnUkVRVUlSRVNfTE9XRVJDQVNFJyk7XG4gICAgICAgIHBvbGljeS5yZXF1aXJlVXBwZXJjYXNlICYmIHJlcXVpcmVtZW50cy5wdXNoKCdSRVFVSVJFU19VUFBFUkNBU0UnKTtcbiAgICAgICAgcG9saWN5LnJlcXVpcmVTeW1ib2xzICYmIHJlcXVpcmVtZW50cy5wdXNoKCdSRVFVSVJFU19TWU1CT0xTJyk7XG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShyZXF1aXJlbWVudHMpO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIGV4dHJhY3QgdGhlIE1GQSBjb25maWd1cmF0aW9uIHNldHRpbmcgZnJvbSB0aGUgVXNlclBvb2wgcmVzb3VyY2VcbiAgICBvdXRwdXQubWZhQ29uZmlndXJhdGlvbiA9IExhenkuc3RyaW5nKHtcbiAgICAgIHByb2R1Y2U6ICgpID0+IHtcbiAgICAgICAgcmV0dXJuIGNmblVzZXJQb29sLm1mYUNvbmZpZ3VyYXRpb24gPz8gJ09GRic7XG4gICAgICB9LFxuICAgIH0pO1xuICAgIC8vIGV4dHJhY3QgdGhlIE1GQSB0eXBlcyBmcm9tIHRoZSBVc2VyUG9vbCByZXNvdXJjZVxuICAgIG91dHB1dC5tZmFUeXBlcyA9IExhenkuc3RyaW5nKHtcbiAgICAgIHByb2R1Y2U6ICgpID0+IHtcbiAgICAgICAgY29uc3QgZW5hYmxlZE1mYXMgPSBjZm5Vc2VyUG9vbC5lbmFibGVkTWZhcyA/PyBbXTtcbiAgICAgICAgY29uc3QgbWZhVHlwZXM6IHN0cmluZ1tdID0gW107XG4gICAgICAgIGVuYWJsZWRNZmFzLmZvckVhY2goKHR5cGUpID0+IHtcbiAgICAgICAgICBpZiAodHlwZSA9PT0gJ1NNU19NRkEnKSB7XG4gICAgICAgICAgICBtZmFUeXBlcy5wdXNoKCdTTVMnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHR5cGUgPT09ICdTT0ZUV0FSRV9UT0tFTl9NRkEnKSB7XG4gICAgICAgICAgICBtZmFUeXBlcy5wdXNoKCdUT1RQJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICh0eXBlID09PSAnRU1BSUxfT1RQJykge1xuICAgICAgICAgICAgbWZhVHlwZXMucHVzaCgnRU1BSUwnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkobWZhVHlwZXMpO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIGV4dHJhY3Qgc29jaWFsIHByb3ZpZGVycyBmcm9tIFVzZXJQb29sIHJlc291cmNlXG4gICAgb3V0cHV0LnNvY2lhbFByb3ZpZGVycyA9IExhenkuc3RyaW5nKHtcbiAgICAgIHByb2R1Y2U6ICgpID0+IHtcbiAgICAgICAgY29uc3Qgb3V0cHV0UHJvdmlkZXJzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgICBjb25zdCB1c2VyUG9vbFByb3ZpZGVycyA9IHRoaXMucmVzb3VyY2VzLnVzZXJQb29sLmlkZW50aXR5UHJvdmlkZXJzO1xuICAgICAgICBpZiAoIXVzZXJQb29sUHJvdmlkZXJzIHx8IHVzZXJQb29sUHJvdmlkZXJzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IHByb3ZpZGVyIG9mIHVzZXJQb29sUHJvdmlkZXJzKSB7XG4gICAgICAgICAgY29uc3QgcHJvdmlkZXJSZXNvdXJjZSA9IHByb3ZpZGVyLm5vZGUuZmluZENoaWxkKFxuICAgICAgICAgICAgJ1Jlc291cmNlJyxcbiAgICAgICAgICApIGFzIENmblVzZXJQb29sSWRlbnRpdHlQcm92aWRlcjtcbiAgICAgICAgICBpZiAoIShwcm92aWRlclJlc291cmNlIGluc3RhbmNlb2YgQ2ZuVXNlclBvb2xJZGVudGl0eVByb3ZpZGVyKSkge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgICAgICdDb3VsZCBub3QgZmluZCB0aGUgQ2ZuVXNlclBvb2xJZGVudGl0eVByb3ZpZGVyIHJlc291cmNlIGluIHRoZSBzdGFjay4nLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgcHJvdmlkZXJUeXBlID0gcHJvdmlkZXJSZXNvdXJjZS5wcm92aWRlclR5cGU7XG4gICAgICAgICAgY29uc3QgcHJvdmlkZXJOYW1lID0gcHJvdmlkZXJSZXNvdXJjZS5wcm92aWRlck5hbWU7XG4gICAgICAgICAgaWYgKHByb3ZpZGVyVHlwZSA9PT0gJ0dvb2dsZScpIHtcbiAgICAgICAgICAgIG91dHB1dFByb3ZpZGVycy5wdXNoKCdHT09HTEUnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHByb3ZpZGVyVHlwZSA9PT0gJ0ZhY2Vib29rJykge1xuICAgICAgICAgICAgb3V0cHV0UHJvdmlkZXJzLnB1c2goJ0ZBQ0VCT09LJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChwcm92aWRlclR5cGUgPT09ICdTaWduSW5XaXRoQXBwbGUnKSB7XG4gICAgICAgICAgICBvdXRwdXRQcm92aWRlcnMucHVzaCgnU0lHTl9JTl9XSVRIX0FQUExFJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChwcm92aWRlclR5cGUgPT09ICdMb2dpbldpdGhBbWF6b24nKSB7XG4gICAgICAgICAgICBvdXRwdXRQcm92aWRlcnMucHVzaCgnTE9HSU5fV0lUSF9BTUFaT04nKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHByb3ZpZGVyVHlwZSA9PT0gJ09JREMnKSB7XG4gICAgICAgICAgICBvdXRwdXRQcm92aWRlcnMucHVzaChwcm92aWRlck5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAocHJvdmlkZXJUeXBlID09PSAnU0FNTCcpIHtcbiAgICAgICAgICAgIG91dHB1dFByb3ZpZGVycy5wdXNoKHByb3ZpZGVyTmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShvdXRwdXRQcm92aWRlcnMpO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIG91dHB1dC5vYXV0aENvZ25pdG9Eb21haW4gPSBMYXp5LnN0cmluZyh7XG4gICAgICBwcm9kdWNlOiAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHVzZXJQb29sRG9tYWluID0gdGhpcy5yZXNvdXJjZXMudXNlclBvb2wubm9kZS50cnlGaW5kQ2hpbGQoXG4gICAgICAgICAgYCR7dGhpcy5uYW1lfVVzZXJQb29sRG9tYWluYCxcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKCF1c2VyUG9vbERvbWFpbikge1xuICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfVxuICAgICAgICBpZiAoISh1c2VyUG9vbERvbWFpbiBpbnN0YW5jZW9mIFVzZXJQb29sRG9tYWluKSkge1xuICAgICAgICAgIHRocm93IEVycm9yKCdDb3VsZCBub3QgZmluZCBVc2VyUG9vbERvbWFpbiByZXNvdXJjZSBpbiB0aGUgc3RhY2suJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGAke3VzZXJQb29sRG9tYWluLmRvbWFpbk5hbWV9LmF1dGguJHtcbiAgICAgICAgICBTdGFjay5vZih0aGlzKS5yZWdpb25cbiAgICAgICAgfS5hbWF6b25jb2duaXRvLmNvbWA7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgb3V0cHV0Lm9hdXRoU2NvcGUgPSBMYXp5LnN0cmluZyh7XG4gICAgICBwcm9kdWNlOiAoKSA9PiB7XG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShjZm5Vc2VyUG9vbENsaWVudC5hbGxvd2VkT0F1dGhTY29wZXMgPz8gW10pO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIG91dHB1dC5vYXV0aFJlZGlyZWN0U2lnbkluID0gTGF6eS5zdHJpbmcoe1xuICAgICAgcHJvZHVjZTogKCkgPT4ge1xuICAgICAgICByZXR1cm4gY2ZuVXNlclBvb2xDbGllbnQuY2FsbGJhY2tVckxzXG4gICAgICAgICAgPyBjZm5Vc2VyUG9vbENsaWVudC5jYWxsYmFja1VyTHMuam9pbignLCcpXG4gICAgICAgICAgOiAnJztcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBvdXRwdXQub2F1dGhSZWRpcmVjdFNpZ25PdXQgPSBMYXp5LnN0cmluZyh7XG4gICAgICBwcm9kdWNlOiAoKSA9PiB7XG4gICAgICAgIHJldHVybiBjZm5Vc2VyUG9vbENsaWVudC5sb2dvdXRVckxzXG4gICAgICAgICAgPyBjZm5Vc2VyUG9vbENsaWVudC5sb2dvdXRVckxzLmpvaW4oJywnKVxuICAgICAgICAgIDogJyc7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgb3V0cHV0Lm9hdXRoUmVzcG9uc2VUeXBlID0gTGF6eS5zdHJpbmcoe1xuICAgICAgcHJvZHVjZTogKCkgPT4ge1xuICAgICAgICByZXR1cm4gY2ZuVXNlclBvb2xDbGllbnQuYWxsb3dlZE9BdXRoRmxvd3NcbiAgICAgICAgICA/IGNmblVzZXJQb29sQ2xpZW50LmFsbG93ZWRPQXV0aEZsb3dzLmpvaW4oJywnKVxuICAgICAgICAgIDogJyc7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgb3V0cHV0Lm9hdXRoQ2xpZW50SWQgPSBMYXp5LnN0cmluZyh7XG4gICAgICBwcm9kdWNlOiAoKSA9PiB7XG4gICAgICAgIHJldHVybiBjZm5Vc2VyUG9vbENsaWVudC5yZWY7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gdXNlciBncm91cCBwcmVjZWRlbmNlIGNhbiBiZSBvdmVyd3JpdHRlbiwgc28gdGhleSBhcmUgZXhwb3NlZCB2aWEgY2RrIExBWllcbiAgICBvdXRwdXQuZ3JvdXBzID0gTGF6eS5zdHJpbmcoe1xuICAgICAgcHJvZHVjZTogKCkgPT4ge1xuICAgICAgICBjb25zdCBncm91cHNBcnJheToge1xuICAgICAgICAgIFtrZXk6IHN0cmluZ106IHtcbiAgICAgICAgICAgIHByZWNlZGVuY2U/OiBudW1iZXI7XG4gICAgICAgICAgfTtcbiAgICAgICAgfVtdID0gW107XG4gICAgICAgIE9iamVjdC5rZXlzKHRoaXMucmVzb3VyY2VzLmdyb3VwcykuZm9yRWFjaChcbiAgICAgICAgICAoZ3JvdXBOYW1lKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBwcmVjZWRlbmNlID1cbiAgICAgICAgICAgICAgdGhpcy5yZXNvdXJjZXMuZ3JvdXBzW2dyb3VwTmFtZV0uY2ZuVXNlckdyb3VwLnByZWNlZGVuY2U7XG4gICAgICAgICAgICBncm91cHNBcnJheS5wdXNoKHtcbiAgICAgICAgICAgICAgW2dyb3VwTmFtZV06IHtcbiAgICAgICAgICAgICAgICBwcmVjZWRlbmNlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB7fSBhcyBSZWNvcmQ8c3RyaW5nLCB7IHByZWNlZGVuY2U/OiBudW1iZXIgfT4sXG4gICAgICAgICk7XG5cbiAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGdyb3Vwc0FycmF5KTtcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBvdXRwdXRTdG9yYWdlU3RyYXRlZ3kuYWRkQmFja2VuZE91dHB1dEVudHJ5KGF1dGhPdXRwdXRLZXksIHtcbiAgICAgIHZlcnNpb246ICcxJyxcbiAgICAgIHBheWxvYWQ6IG91dHB1dCxcbiAgICB9KTtcbiAgfTtcbn1cbiJdfQ==